import{a as x,j as e,H as I,L as V}from"./app-BkNEVUgA.js";import{A as L}from"./app-layout-B_VorJ6Y.js";import{C as u,c as h,a as B,b as q}from"./card-_SpODdaT.js";import{B as G}from"./badge-UIBr-bNI.js";import{P as K}from"./progress-CPtudKSC.js";import{T as w}from"./triangle-alert-tOvemL1h.js";import{F as U,C as D}from"./file-text-b_sOTYjC.js";import{C as X}from"./clock-CWdfsfZA.js";import{C as W}from"./calendar-DUwO-DPr.js";import{B as A}from"./building-DdzTXdTn.js";/* empty css            */import"./button-CE1kZdZE.js";import"./index-Bol82lma.js";import"./index-Csa5XfmV.js";import"./createLucideIcon-DdVcucaf.js";import"./index-u1-Hf6Gb.js";import"./index-DW9AIAM8.js";import"./log-out-BgSMYiLv.js";let E=0;const J=(j,_)=>{const S=String(j),N=String(_),f=`${S}-${N}`;let c=0;for(let g=0;g<f.length;g++){const y=f.charCodeAt(g);c=(c<<5)-c+y,c=c&c}const v=Math.abs(c).toString(16).substring(0,8);return console.log(`üîó generateCampusHash: "${f}" ‚Üí ${v}`),v},O=[{name:"Aprobados",value:71.5,colorClass:"bg-emerald-500",textClass:"text-emerald-600 dark:text-emerald-400"},{name:"Pendientes",value:18.8,colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"},{name:"Rechazados",value:9.7,colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"}],Q=()=>e.jsxs("div",{className:"p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-600 rounded w-24"}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-300 dark:bg-gray-600"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-gray-600 rounded w-16"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-16"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-8"})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gray-300 dark:bg-gray-600 rounded-full w-1/2"})})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-8"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-12"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-10"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-14"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]})]})]})]}),p=()=>e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 animate-pulse",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-600 rounded w-16 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-600 rounded w-12"})]})]})})}),Y=j=>{switch(j){case"excelente":return{icon:D,label:"Excelente",color:"bg-emerald-500 dark:bg-emerald-400",textColor:"text-emerald-700 dark:text-emerald-300",bgColor:"bg-emerald-50 dark:bg-emerald-950/20",borderColor:"border-emerald-200 dark:border-emerald-800"};case"bueno":return{icon:D,label:"Bueno",color:"bg-blue-500 dark:bg-blue-400",textColor:"text-blue-700 dark:text-blue-300",bgColor:"bg-blue-50 dark:bg-blue-950/20",borderColor:"border-blue-200 dark:border-blue-800"};case"advertencia":return{icon:w,label:"Advertencia",color:"bg-amber-500 dark:bg-amber-400",textColor:"text-amber-700 dark:text-amber-300",bgColor:"bg-amber-50 dark:bg-amber-950/20",borderColor:"border-amber-200 dark:border-amber-800"};case"critico":default:return{icon:w,label:"Cr√≠tico",color:"bg-red-500 dark:bg-red-400",textColor:"text-red-700 dark:text-red-300",bgColor:"bg-red-50 dark:bg-red-950/20",borderColor:"border-red-200 dark:border-red-800"}}};function ve({estadisticasGenerales:j,datosSemaforo:_,tendenciasMensuales:S}){const[N,f]=x.useState(null),[c,v]=x.useState(!0),[g,y]=x.useState(null),[i,H]=x.useState(j),[z,R]=x.useState(_),[Z,ee]=x.useState(S);(()=>{const s=i.totalDocumentos;return s===0?O:[{name:"Aprobados",value:parseFloat((i.documentosAprobados/s*100).toFixed(1)),colorClass:"bg-emerald-500",textClass:"text-emerald-600 dark:text-emerald-400"},{name:"Pendientes",value:parseFloat((i.documentosPendientes/s*100).toFixed(1)),colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"},{name:"Rechazados",value:parseFloat((i.documentosRechazados/s*100).toFixed(1)),colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"}]})(),x.useEffect(()=>{const s=async()=>{try{v(!0);const t=await fetch("/api/supervision/estadisticas",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if(console.log("üìä Datos de supervisi√≥n recibidos:",a),f(a),a.tipo_usuario==="supervisor"){const l=F(a),r=M(a.estadisticas_por_campus||[]);H(l),R(r)}y(null)}catch(t){console.error("‚ùå Error cargando datos de supervisi√≥n:",t),y("Error al cargar datos de supervisi√≥n")}finally{v(!1)}};s();const d=setInterval(s,300*1e3);return()=>clearInterval(d)},[]);const F=s=>{if(s.estadisticas_por_campus&&Array.isArray(s.estadisticas_por_campus)){const d=s.estadisticas_por_campus.reduce((n,o)=>n+(o.total_documentos||0),0),t=s.estadisticas_por_campus.reduce((n,o)=>n+(o.total_aprobados||0),0),a=s.estadisticas_por_campus.reduce((n,o)=>n+(o.total_caducados||0),0),l=s.estadisticas_por_campus.reduce((n,o)=>n+((o.fiscales?.rechazados||0)+(o.medicos?.rechazados||0)),0),r=Math.max(0,d-t-a-l);return{totalDocumentos:d,documentosAprobados:t,documentosPendientes:r,documentosRechazados:l,usuariosActivos:s.estadisticas?.usuarios_activos||0,campusConectados:s.estadisticas_por_campus.length}}else{const d=s.estadisticas||{},t=s.estadisticas_fiscales||{},a=s.estadisticas_medicos||{},l=(t.total_documentos||t.total||0)+(a.total_documentos||a.total||0),r=(t.aprobados||0)+(a.aprobados||0),n=(t.caducados||0)+(a.caducados||0),o=(t.rechazados||0)+(a.rechazados||0),m=Math.max(0,l-r-n-o);return{totalDocumentos:l,documentosAprobados:r,documentosPendientes:m,documentosRechazados:o,usuariosActivos:d.usuarios_activos||0,campusConectados:d.total_campus||0}}},M=s=>{if(!s||!Array.isArray(s))return[];const d=s.filter((a,l,r)=>{const n=String(a.campus_id||a.id),o=a.campus_nombre||a.nombre;return r.findIndex(m=>{const C=String(m.campus_id||m.id),b=m.campus_nombre||m.nombre;return C===n&&b===o})===l});console.log("ÔøΩ Campus procesados:",s.length,"‚Üí Campus √∫nicos:",d.length),s.length!==d.length&&console.warn(`‚ö†Ô∏è Se eliminaron ${s.length-d.length} campus duplicados`);const t=d.map((a,l)=>{E++;const r=String(a.campus_id||a.id||"unknown"),n=r.padStart(2,"0"),o=a.campus_nombre||a.nombre||"Campus desconocido",m=`campus-${E}-${n}`,C=J(o,r);console.log(`üîó Campus: ${o} (ID: ${r}) ‚Üí Hash: ${C}`);const b=a.porcentaje_cumplimiento||a.cumplimiento||0;let k="critico";b>=90?k="excelente":b>=80?k="bueno":b>=70&&(k="advertencia");const P=a.total_vigentes||a.total_aprobados||0,T=a.total_caducados||0;return{campus:o,estado:k,cumplimiento:b,documentosTotal:a.total_documentos||a.documentos_total||0,documentosVigentes:P,documentosCaducados:T,documentosVencidos:Math.max(0,(a.total_documentos||0)-P),usuariosActivos:a.usuarios_activos||1,id_campus:n,campusHash:C,uniqueKey:m}});return console.log("üìä Datos del sem√°foro procesados:",t.map(a=>({campus:a.campus,id:a.id_campus,hash:a.campusHash}))),t},$=x.useMemo(()=>[...z],[z.length]);return e.jsxs(L,{breadcrumbs:[{title:"Dashboard",href:"/dashboard"},{title:"Supervisi√≥n",href:"/supervision"}],children:[e.jsx(I,{title:"Dashboard de Supervisi√≥n"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"Dashboard de Supervisi√≥n"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo en tiempo real del estado de documentos  por campus"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Actualizando..."]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(w,{className:"w-4 h-4"}),g]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-6",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Documentos"}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalDocumentos.toLocaleString()})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Vigentes"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:N?.documentosVigentes||i.documentosAprobados})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-amber-700 dark:text-amber-300",children:i.documentosPendientes})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Caducados"}),e.jsx("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:N?.documentosCaducados||0})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rechazados"}),e.jsx("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:i.documentosRechazados})]})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Campus Activos"}),e.jsx("p",{className:"text-2xl font-bold",children:$.length})]})]})})})]})}),e.jsxs(u,{children:[e.jsx(B,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Estado por Campus - Sem√°foro de Cumplimiento"]})}),e.jsx(h,{children:c?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8},(s,d)=>e.jsx(Q,{},`skeleton-${d}`))}):$.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay campus disponibles para mostrar"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:$.map((s,d)=>{const t=Y(s.estado),a=t.icon;return e.jsx(V,{href:`/supervision/${s.campusHash||"unknown"}`,className:"block",onClick:l=>{const r=s.campusHash;if(console.log(`üîó Navegando a campus ${s.campus} con hash: ${r}`),!r||r==="unknown"){l.preventDefault(),console.error("‚ùå Hash inv√°lido para campus:",s),alert(`Error: No se pudo generar hash para ${s.campus}`);return}console.log(`‚úÖ Navegando a URL: /supervision/${r}`)},children:e.jsxs("div",{className:`p-4 rounded-lg border-2 ${t.bgColor} ${t.borderColor} transition-all hover:shadow-lg hover:scale-105 cursor-pointer`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-sm",children:s.campus})}),e.jsx("div",{className:`w-4 h-4 rounded-full ${t.color} animate-pulse`})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:`w-4 h-4 ${t.textColor}`}),e.jsx(G,{className:`${t.bgColor} ${t.textColor} hover:${t.bgColor}`,children:t.label})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{children:"Cumplimiento"}),e.jsxs("span",{className:"font-medium",children:[s.cumplimiento,"%"]})]}),e.jsx(K,{value:s.cumplimiento,className:"h-2"})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:s.documentosTotal})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Vigentes:"}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:s.documentosVigentes})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Caducados:"}),e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:s.documentosCaducados})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pendientes:"}),e.jsx("span",{className:`font-medium ${s.documentosVencidos>20?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`,children:s.documentosVencidos})]})]})]})]})},s.uniqueKey||`fallback-${d}-${s.id_campus}`)})})})]})]})]})}export{ve as default};
