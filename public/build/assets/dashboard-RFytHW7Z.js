import{a as x,j as e,H as B,L as q}from"./app-BqQdOloM.js";import{A as G}from"./app-layout-BfWWNwEy.js";import{C as g,c as b,a as K,b as X}from"./card-DfV65zQP.js";import{B as U}from"./badge-B7rWyoEI.js";import{P as W}from"./progress-HeeqvZ_v.js";import{T as A}from"./triangle-alert-D7i92BCT.js";import{F as J,C as R}from"./file-text-RYsMGKLW.js";import{C as O}from"./clock-dJiTc1yk.js";import{C as Q}from"./calendar-Btxe1L_I.js";import{B as $}from"./building-BOZcXCP8.js";/* empty css            */import"./button-D1oVf4ds.js";import"./index-DnlVN_Yb.js";import"./createLucideIcon-Cd24xIgO.js";import"./index-F78BPGYV.js";import"./index-DW9AIAM8.js";import"./log-out-DP9Dp_TC.js";let M=0;const Y=(y,v)=>{const D=String(y),T=String(v),_=`${D}-${T}`;let l=0;for(let N=0;N<_.length;N++){const w=_.charCodeAt(N);l=(l<<5)-l+w,l=l&4294967295}return Math.abs(l).toString(16).padStart(8,"0").substring(0,8)},Z=[{name:"Aprobados",value:71.5,colorClass:"bg-emerald-500",textClass:"text-emerald-600 dark:text-emerald-400"},{name:"Pendientes",value:18.8,colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"},{name:"Rechazados",value:9.7,colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"}],ee=()=>e.jsxs("div",{className:"p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-600 rounded w-24"}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-300 dark:bg-gray-600"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-6 bg-gray-300 dark:bg-gray-600 rounded w-16"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-16"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-8"})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gray-300 dark:bg-gray-600 rounded-full w-1/2"})})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-8"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-12"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-10"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-14"}),e.jsx("div",{className:"h-3 bg-gray-300 dark:bg-gray-600 rounded w-6"})]})]})]})]}),C=()=>e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 animate-pulse",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-300 dark:bg-gray-600 rounded w-16 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-600 rounded w-12"})]})]})})}),se=y=>{switch(y){case"excelente":return{icon:R,label:"Excelente",color:"bg-emerald-500 dark:bg-emerald-400",textColor:"text-emerald-700 dark:text-emerald-300",bgColor:"bg-emerald-50 dark:bg-emerald-950/20",borderColor:"border-emerald-200 dark:border-emerald-800"};case"bueno":return{icon:R,label:"Bueno",color:"bg-blue-500 dark:bg-blue-400",textColor:"text-blue-700 dark:text-blue-300",bgColor:"bg-blue-50 dark:bg-blue-950/20",borderColor:"border-blue-200 dark:border-blue-800"};case"advertencia":return{icon:A,label:"Advertencia",color:"bg-amber-500 dark:bg-amber-400",textColor:"text-amber-700 dark:text-amber-300",bgColor:"bg-amber-50 dark:bg-amber-950/20",borderColor:"border-amber-200 dark:border-amber-800"};case"critico":default:return{icon:A,label:"Crítico",color:"bg-red-500 dark:bg-red-400",textColor:"text-red-700 dark:text-red-300",bgColor:"bg-red-50 dark:bg-red-950/20",borderColor:"border-red-200 dark:border-red-800"}}};function Ce({estadisticasGenerales:y,datosSemaforo:v,tendenciasMensuales:D}){const[T,_]=x.useState(null),[l,I]=x.useState(!0),[z,N]=x.useState(null),w=s=>{if(!s||!Array.isArray(s))return[];const d=s.filter((a,m,n)=>{const u=String(a.campus_id||a.id),p=a.campus_nombre||a.nombre;return n.findIndex(h=>{const r=String(h.campus_id||h.id),o=h.campus_nombre||h.nombre;return r===u&&o===p})===m});return s.length,d.length,d.map((a,m)=>{M++;const u=String(a.campus_id||a.id||"unknown").padStart(2,"0"),p=a.campus_nombre||a.nombre||"Campus desconocido",h=`campus-${M}-${u}`;let r=a.campus_hash;(!r||r.length<8)&&(r=Y(p,u));const o=a.porcentaje_cumplimiento||a.cumplimiento||0;let j="critico";o>=90?j="excelente":o>=80?j="bueno":o>=70&&(j="advertencia");const k=parseInt(a.total_vigentes??a.total_aprobados??0)||0,S=parseInt(a.total_caducados??0)||0,c=k+S;return{campus:p,estado:j,cumplimiento:o,documentosTotal:parseInt(a.total_documentos??a.documentosTotal??a.documentos_total??0)||0,documentosVigentes:k,documentosCaducados:S,documentosCumplidos:c,documentosVencidos:Math.max(0,(parseInt(a.total_documentos??a.documentosTotal??a.documentosVencidos??0)||0)-c),usuariosActivos:parseInt(a.usuarios_activos??a.usuariosActivos??1)||1,id_campus:u,campusHash:r,uniqueKey:h}})},F=x.useMemo(()=>v.length>0&&v[0].documentosVigentes!==void 0?v:w(v),[]),[i,V]=x.useState(y),[E,H]=x.useState(F),[ae,te]=x.useState(D);(()=>{const s=i.totalDocumentos;return s===0?Z:[{name:"Aprobados",value:parseFloat((i.documentosAprobados/s*100).toFixed(1)),colorClass:"bg-emerald-500",textClass:"text-emerald-600 dark:text-emerald-400"},{name:"Pendientes",value:parseFloat((i.documentosPendientes/s*100).toFixed(1)),colorClass:"bg-amber-500",textClass:"text-amber-600 dark:text-amber-400"},{name:"Rechazados",value:parseFloat((i.documentosRechazados/s*100).toFixed(1)),colorClass:"bg-red-500",textClass:"text-red-600 dark:text-red-400"}]})(),x.useEffect(()=>{const s=async()=>{try{I(!0);const t=await fetch("/api/supervision/estadisticas",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if(_(a),a.tipo_usuario==="supervisor"){const m=L(a),n=w(a.estadisticas_por_campus||[]);V(m),H(n)}N(null)}catch{N("Error al cargar datos de supervisión")}finally{I(!1)}};s();const d=setInterval(s,300*1e3);return()=>clearInterval(d)},[]);const L=s=>{if(s.totales_por_tipo&&(s.totales_por_tipo.FISCAL||s.totales_por_tipo.MEDICINA)){const r=s.totales_por_tipo.FISCAL||{Vigentes:0,Caducados:0,Rechazados:0,Pendientes:0,Total:0},o=s.totales_por_tipo.MEDICINA||{Vigentes:0,Caducados:0,Rechazados:0,Pendientes:0,Total:0};return{totalDocumentos:r.Total+o.Total,documentosAprobados:r.Vigentes+o.Vigentes,documentosPendientes:r.Pendientes+o.Pendientes,documentosRechazados:r.Rechazados+o.Rechazados,documentosCaducados:r.Caducados+o.Caducados,usuariosActivos:s.estadisticas_generales?.usuarios_activos||0,campusConectados:s.estadisticas_por_campus?.length||0}}if(s.estadisticas_por_campus&&Array.isArray(s.estadisticas_por_campus)){const r=s.estadisticas_por_campus.reduce((c,f)=>c+(f.total_documentos||0),0),o=s.estadisticas_por_campus.reduce((c,f)=>c+(f.total_aprobados||0),0),j=s.estadisticas_por_campus.reduce((c,f)=>c+(f.total_caducados||0),0),k=s.estadisticas_por_campus.reduce((c,f)=>c+(f.total_rechazados||0),0),S=Math.max(0,r-o-j-k);return{totalDocumentos:r,documentosAprobados:o,documentosPendientes:S,documentosRechazados:k,documentosCaducados:j,usuariosActivos:s.estadisticas?.usuarios_activos||0,campusConectados:s.estadisticas_por_campus.length}}const d=s.estadisticas||{},t=s.estadisticas_legales||s.estadisticas_fiscales||{},a=s.estadisticas_medicos||{},m=(t.total_documentos||t.total||0)+(a.total_documentos||a.total||0),n=(t.aprobados||0)+(a.aprobados||0),u=(t.caducados||0)+(a.caducados||0),p=(t.rechazados||0)+(a.rechazados||0),h=Math.max(0,m-n-u-p);return{totalDocumentos:m,documentosAprobados:n,documentosPendientes:h,documentosRechazados:p,documentosCaducados:u,usuariosActivos:d.usuarios_activos||0,campusConectados:d.total_campus||0}},P=x.useMemo(()=>[...E].sort((s,d)=>s.campus.localeCompare(d.campus)),[E.length]);return e.jsxs(G,{breadcrumbs:[{title:"Dashboard",href:"/dashboard"},{title:"Supervisión",href:"/supervision"}],children:[e.jsx(B,{title:"Dashboard de Supervisión"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2 text-gray-900 dark:text-gray-100",children:"Dashboard de Supervisión"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitoreo en tiempo real del estado de documentos por campus"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Actualizando..."]}),z&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[e.jsx(A,{className:"w-4 h-4"}),z]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-6",children:l?e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Total Documentos"}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalDocumentos.toLocaleString()})]})]})})}),e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Vigentes"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:i.documentosAprobados})]})]})})}),e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-amber-700 dark:text-amber-300",children:i.documentosPendientes})]})]})})}),e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Caducados"}),e.jsx("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:i.documentosCaducados})]})]})})}),e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rechazados"}),e.jsx("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:i.documentosRechazados})]})]})})}),e.jsx(g,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-indigo-600 dark:text-indigo-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Campus Activos"}),e.jsx("p",{className:"text-2xl font-bold",children:P.length})]})]})})})]})}),e.jsxs(g,{children:[e.jsx(K,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Estado por Campus - Semáforo de Cumplimiento"]})}),e.jsx(b,{children:l?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8},(s,d)=>e.jsx(ee,{},`skeleton-${d}`))}):P.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay campus disponibles para mostrar"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:P.map((s,d)=>{const t=se(s.estado),a=t.icon;return e.jsx(q,{href:`/supervision/${s.campusHash||"unknown"}`,className:"block",onClick:m=>{const n=s.campusHash;if(!n||n==="unknown"||n.length<8){m.preventDefault(),alert(`Error: No se pudo generar hash válido para ${s.campus}`);return}},children:e.jsxs("div",{className:`p-4 rounded-lg border-2 ${t.bgColor} ${t.borderColor} transition-all hover:shadow-lg hover:scale-105 cursor-pointer`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-sm",children:s.campus})}),e.jsx("div",{className:`w-4 h-4 rounded-full ${t.color} animate-pulse`})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:`w-4 h-4 ${t.textColor}`}),e.jsx(U,{className:`${t.bgColor} ${t.textColor} hover:${t.bgColor}`,children:t.label})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{children:"Cumplimiento"}),e.jsxs("span",{className:"font-medium",children:[s.cumplimiento,"%"]})]}),e.jsx(W,{value:s.cumplimiento,className:"h-2"})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:s.documentosTotal})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cumplidos:"}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:s.documentosCumplidos})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"• Vigentes:"}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400 text-xs",children:s.documentosVigentes})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"• Caducados:"}),e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400 text-xs",children:s.documentosCaducados})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pendientes:"}),e.jsx("span",{className:`font-medium ${s.documentosVencidos>20?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`,children:s.documentosVencidos})]})]})]})]})},s.uniqueKey||`fallback-${d}-${s.id_campus}`)})})})]})]})]})}export{Ce as default};
