import{a as u,j as e,H as Fa,c as Ee}from"./app-BqQdOloM.js";import{A as Pa,X as pe,U as ae}from"./app-layout-BfWWNwEy.js";import{C as R,c as I,a as be,b as je}from"./card-DfV65zQP.js";import{B as E}from"./button-D1oVf4ds.js";import{B as Z}from"./badge-B7rWyoEI.js";import{P as ta}from"./progress-HeeqvZ_v.js";import{I as Ma}from"./input-D5D6M-is.js";import{L as Te}from"./label-De7vxEwN.js";import{S as $e,a as Re,b as Ie,c as Fe,d as ve}from"./select-DxEhwbcd.js";import{C as U,F as X}from"./file-text-RYsMGKLW.js";import{L as ee}from"./loader-circle-DlAUaYwx.js";import{C as L}from"./circle-alert-DqHDldU8.js";import{C as na}from"./clock-dJiTc1yk.js";import{C as J}from"./calendar-Btxe1L_I.js";import{c as ia}from"./createLucideIcon-Cd24xIgO.js";import{B as ca}from"./brain-CdnosIuj.js";import{E as ra}from"./eye-CcnjDP9r.js";/* empty css            */import"./index-DnlVN_Yb.js";import"./index-F78BPGYV.js";import"./index-DW9AIAM8.js";import"./log-out-DP9Dp_TC.js";import"./check-Ptbkea7d.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Va=ia("Plus",qa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Ba=ia("Search",La),Oa=l=>{switch(l){case"pendiente":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";case"subido":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"vigente":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 border-green-200 dark:border-green-800";case"caducado":return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-200 dark:border-orange-800";case"rechazado":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400 border-red-200 dark:border-red-800";default:return"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-700"}},Ua=l=>{switch(l){case"pendiente":return e.jsx(na,{className:"w-4 h-4"});case"subido":return e.jsx(ae,{className:"w-4 h-4"});case"vigente":return e.jsx(U,{className:"w-4 h-4"});case"caducado":return e.jsx(J,{className:"w-4 h-4"});case"rechazado":return e.jsx(L,{className:"w-4 h-4"});case"subiendo":return e.jsx(ae,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-pulse"});case"procesando":return e.jsx(ee,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 animate-spin"});case"analizando":return e.jsx(ca,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-pulse"});case"completado":return e.jsx(U,{className:"w-4 h-4 text-green-600 dark:text-green-400"});case"error":return e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"});default:return e.jsx(X,{className:"w-4 h-4"})}},Me=l=>{if(!l||l===0||isNaN(l))return"0 Bytes";const m=1024,j=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(l)/Math.log(m));return parseFloat((l/Math.pow(m,P)).toFixed(2))+" "+j[P]},Ne=l=>{if(!l)return"Fecha no disponible";try{let m;if(l.includes("-"))if(l.match(/^\d{4}-\d{2}-\d{2}$/)){const[j,P,v]=l.split("-");m=new Date(parseInt(j),parseInt(P)-1,parseInt(v))}else m=new Date(l);else isNaN(Number(l))?m=new Date(l):m=new Date(Number(l));return isNaN(m.getTime())?"Fecha inválida":m.toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})}catch(m){return console.error("Error formateando fecha:",l,m),"Fecha inválida"}},oa=l=>{const m=l.fechaExpedicion,j=l.vigenciaDocumento;if(l.diasRestantesVigencia,!m&&!j)return`${Me(l.tamaño||0)} • ${Ne(l.fechaSubida)}`;let P=Me(l.tamaño||0);return m&&(P+=` • ${Ne(m)}`),P},Pe=l=>{const m=l.archivos?.find(j=>j.estado==="completado"&&(j.metadata?.vigencia_documento||j.vigenciaDocumento));if(m){const j=m.metadata?.vigencia_documento||m.vigenciaDocumento;if(j){const P=new Date(j),v=new Date,ie=P.getTime()-v.getTime(),ce=Math.ceil(ie/(1e3*60*60*24));return{fecha:j,diasRestantes:ce,esVigenciaReal:!0}}}return{fecha:l.fechaLimite,diasRestantes:null,esVigenciaReal:!1}},gs=({campusDelDirector:l,documentosRequeridos:m,campusSeleccionado:j,error:P})=>{const[v,ie]=u.useState(j),ce=(m||[]).map(a=>({...a,archivos:a.archivos||[]})),[z,B]=u.useState(ce),[qe,ye]=u.useState(null),[se,te]=u.useState({}),[n,D]=u.useState(ce[0]||null),[M,ke]=u.useState("todos"),de=u.useRef(null),[re,da]=u.useState(""),[la,oe]=u.useState(!1),[Ve,F]=u.useState(0),[ma,T]=u.useState(""),[Le,le]=u.useState(""),[K,me]=u.useState(!1),[we,ue]=u.useState(0),[ua,Ce]=u.useState(0),[xa,Be]=u.useState(new Set),[ha,De]=u.useState(!1),[ga,fa]=u.useState(""),[Oe,N]=u.useState(!1),[pa,y]=u.useState(!1),[ba,ne]=u.useState(!1),[O,Ue]=u.useState(null);u.useEffect(()=>{if(console.log("🔄 Sincronizando estado con props de Inertia:",{documentosIniciales:m?.length,campusInicial:j?.ID_Campus}),m&&m.length>0){const a=m.map(t=>({...t,archivos:t.archivos||[]}));B(a),!n&&a.length>0&&D(a[0])}j&&ie(j)},[m,j]);const p=a=>a.uniqueKey||a.id,q=a=>a.archivos||[],ja=a=>{const t=q(a);if(t.length===0)return!0;const s=S(a),r=w(s);return r==="vigente"&&!k(a)?!1:r==="caducado"||k(a)?!0:!(t.find(d=>d.estado==="completado"&&(!d.validacionIA||d.validacionIA.coincide))&&s!=="rechazado")},_e=async()=>{if(v)try{V==="medicos"?await Na():await va()}catch(a){console.error("Error al refrescar documentos:",a),N(!1),y(!0),he(!1)}},va=async()=>{if(v)try{N(!0),y(!1);const a=await fetch(`/documentos/upload?campus=${v.ID_Campus}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(a.ok){const t=await a.json();if(t.props?.documentosRequeridos){const s=(t.props.documentosRequeridos||[]).map(r=>({...r,archivos:r.archivos||[]}));if(B(s),n){const r=s.find(i=>i.id===n.id);r&&D(r)}else s.length>0&&D(s[0]);y(!0),N(!1)}else N(!1),y(!0)}else console.error("Error al actualizar documentos legales:",a.status,a.statusText),N(!1),y(!0)}catch(a){console.error("Error en refrescarDocumentosLegales:",a),N(!1),y(!0)}},Na=async()=>{if(v){N(!0),y(!1),he(!0);try{const a=Date.now(),t=await fetch(`/documentos/medicos-con-sp?campus_id=${v.ID_Campus}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!t.ok)throw new Error(`Error en la respuesta: ${t.status}`);const s=await t.json(),r=Date.now()-a;if(!s.success||!s.carreras_medicas){W([]);return}const i=s.carreras_medicas,d=s.documentos_agrupados||[],o=s.documentos_detalle||{};xe(i);const b=z.filter(g=>g.concepto.toLowerCase().includes("cartas de intención de campo clínico"));if(b.length===0){W([]);return}if(!i||i.length===0){W([]);return}const h=[];if(d&&d.length>0?d.forEach((g,f)=>{const c=g.carrera_nombre;let _=null;const x=o[c]||[];if(x.length>0&&x[0].carrera_id?_=x[0].carrera_id:_=i.find(Ia=>Ia.Descripcion===c)?.ID_Especialidad,!_){console.error(`❌ No se pudo obtener carrera_id para "${c}". Saltando...`);return}const C=b[0],ge=`${C.id}_carrera_${_}`,Ae=(o[c]||[]).filter(A=>A.archivo_id).map(A=>({id:A.archivo_id.toString(),nombre:A.nombre_documento||A.folio_documento||"Documento médico",tamaño:null,fechaSubida:A.subido_en||new Date().toISOString().split("T")[0],estado:"completado",progreso:100,fechaExpedicion:A.fecha_expedicion,vigenciaDocumento:A.vigencia_documento,diasRestantesVigencia:A.dias_restantes_vigencia,metadata:{folio_documento:A.folio_documento,fecha_expedicion:A.fecha_expedicion,vigencia_documento:A.vigencia_documento,estado_bd:A.estado_final}}));let $="pendiente";Ae.length>0?g.Vigentes>0?$="vigente":g.Caducados>0?$="caducado":g.Rechazados>0&&($="rechazado"):$="pendiente";const fe={...C,id:C.id,documentoOriginalId:C.id,uniqueKey:ge,concepto:`${C.concepto} - ${c}`,descripcion:`${C.descripcion} para la carrera de ${c}`,carreraId:String(_),carreraNombre:c,estado:$,archivos:Ae};h.push(fe)}):i.forEach(g=>{const f=g.ID_Especialidad,c=g.Descripcion;b.forEach(_=>{const x=`${_.id}_carrera_${f}`,C={..._,id:_.id,documentoOriginalId:_.id,uniqueKey:x,concepto:`${_.concepto} - ${c}`,descripcion:`${_.descripcion} para la carrera de ${c}`,carreraId:String(f),carreraNombre:c,estado:"pendiente",archivos:[]};h.push(C)})}),W(h),n&&V==="medicos"){const g=h.find(f=>f.uniqueKey===n.uniqueKey||f.carreraNombre===n.carreraNombre&&f.documentoOriginalId===n.documentoOriginalId);g?D(g):h.length>0&&D(h[0])}else!n&&h.length>0&&D(h[0])}catch{W([])}finally{y(!0),N(!1),he(!1)}}},Ke=()=>{setTimeout(()=>{_e()},2e3)};u.useEffect(()=>{console.log("🔄 useEffect de carga inicial ejecutándose con:",{campusInicial:j?.ID_Campus,documentosIniciales:m?.length}),N(!0),y(!1);const a=m?.every(s=>!s.archivos||s.archivos.length===0)||!1,t=!m||m.length===0;if(j&&(t||a))(async()=>{try{const r=await fetch("/documentos/cambiar-campus",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({campus_id:j.ID_Campus})});if(r.ok){const i=await r.json();if(i.documentos){const d=(i.documentos||[]).map(o=>({...o,archivos:o.archivos||[]}));B(d),d.length>0&&D(d[0]),y(!0),N(!1)}else N(!1),y(!0)}else N(!1),y(!0)}catch{N(!1),y(!0)}})();else if(j&&m&&m.length>0&&!a){if(!n&&z.length>0)D(z[0]);else if(!n&&m.length>0){const s={...m[0],archivos:m[0].archivos||[]};D(s)}y(!0),N(!1)}else if(m&&m.length>0){const s=m.map(r=>({...r,archivos:r.archivos||[]}));B(s),!n&&s.length>0&&D(s[0]),y(!0),N(!1)}else N(!1),y(!0)},[j?.ID_Campus,m]),u.useEffect(()=>{z.length>0&&z.forEach((a,t)=>{(a.archivos?.length||0)>0&&a.archivos?.forEach((r,i)=>{})}),z.length>0&&!n&&D(z[0])},[z,n]),u.useEffect(()=>{z.flatMap(t=>(t.archivos||[]).filter(s=>s.estado==="completado"&&!s.fechaExpedicion&&!s.vigenciaDocumento)).forEach(t=>{})},[z]),u.useEffect(()=>{if(n){const a=z.find(t=>p(t)===p(n));a&&a.archivos?.some((s,r)=>{const i=n.archivos?.[r];return i&&(s.fechaExpedicion!==i.fechaExpedicion||s.vigenciaDocumento!==i.vigenciaDocumento||s.diasRestantesVigencia!==i.diasRestantesVigencia)})&&D(a)}},[z]),u.useEffect(()=>{v&&v.ID_Campus&&z.length===0&&_e()},[v]);const ya=(a,t)=>{a.validacionIA&&!a.validacionIA.coincide&&(Ue({fileName:a.nombre,documentType:t,reason:a.validacionIA.razon||"Documento no válido",percentage:a.validacionIA.porcentaje||0,expectedType:t,detectedType:"Información de análisis IA"}),ne(!0))},ka=a=>{const t=q(a);if(t.length===0)return"No hay archivos subidos para este documento";const s=S(a),r=w(s);return r==="rechazado"?"El documento fue rechazado por un administrador. Puede subir un nuevo archivo.":r==="caducado"||k(a)?"El documento ha caducado por vencimiento de fecha. Puede subir un nuevo archivo.":r==="vigente"&&!k(a)?"Documento aprobado por administrador. No se pueden subir más archivos.":t.find(o=>o.estado==="completado"&&(!o.validacionIA||o.validacionIA.coincide))?"Documento validado automáticamente por IA. Esperando revisión del administrador.":t.find(o=>o.estado==="rechazado"||o.validacionIA&&!o.validacionIA.coincide)?"El documento anterior fue rechazado por validación automática. Puede subir un nuevo archivo.":"Puede subir archivos para este documento"},Ge=async a=>{N(!0),y(!1);try{const t=await Ee("/documentos/cambiar-campus",{method:"POST",body:JSON.stringify({campus_id:a})});if(t.ok){const s=await t.json();ie(s.campus);const r=s.documentos.map(i=>({...i,archivos:i.archivos||[]}));B(r),D(r[0]||null),te({}),We("legales"),await He(a),y(!0),N(!1)}else N(!1),y(!0)}catch{N(!1),y(!0)}},He=async a=>{if(a){Je(!0);try{const t=await Ee(`/documentos/campus/${a}/medico`);if(t.ok){const s=await t.json();Se(s.tiene_carreras_medicas),xe(s.carreras_medicas||[]),(s.carreras_medicas||[]).forEach(r=>{})}else Se(!1),xe([])}catch{Se(!1),xe([])}finally{Je(!1)}}},wa=(a,t)=>{a.preventDefault(),ye(t)},Ca=a=>{a.preventDefault(),ye(null)},Da=(a,t)=>{a.preventDefault(),ye(null);const s=Array.from(a.dataTransfer.files);Xe(s,t)},Xe=(a,t)=>{const s=a.filter(r=>{const i=r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf");return i||alert(`El archivo "${r.name}" no es un PDF válido. Solo se permiten archivos PDF.`),i});s.length!==0&&te(r=>({...r,[t]:[...r[t]||[],...s]}))},_a=(a,t)=>{if(a.target.files){const s=Array.from(a.target.files);Xe(s,t)}},za=(a,t)=>{te(s=>({...s,[a]:s[a]?.filter((r,i)=>i!==t)||[]}))},Sa=async a=>{G.forEach((r,i)=>{console.log(`  Doc ${i}: key="${p(r)}", uniqueKey="${r.uniqueKey}", id="${r.id}"`)});const t=se[a],s=G.find(r=>p(r)===a);if(!s){alert("Error: Documento no encontrado");return}if(!t||t.length===0){console.log("No hay archivos para subir"),alert("No hay archivos seleccionados. Por favor selecciona un archivo primero.");return}if(!v?.ID_Campus){console.error("No hay campus seleccionado"),alert("No hay campus seleccionado");return}oe(!0),F(0),T("Preparando archivos..."),me(!1),ue(0),Ce(t.length),te(r=>({...r,[a]:[]}));for(let r=0;r<t.length;r++){const i=t[r];le(i.name),T(`Subiendo ${i.name}...`),F(10);try{const d=new FormData;d.append("archivo",i);const o=s.documentoOriginalId||s.id;if(d.append("documento_id",o.toString()),d.append("campus_id",v.ID_Campus),s.carreraId){const c=String(s.carreraId);d.append("carrera_id",c)}for(let c of d.entries());await new Promise(c=>setTimeout(c,500)),F(25),T(`Validando ${i.name}...`),await new Promise(c=>setTimeout(c,500)),F(50),T(`Guardando ${i.name} en servidor...`),await new Promise(c=>setTimeout(c,500)),F(75),T(`Finalizando subida de ${i.name}...`);const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),h=new FormData;h.append("archivo",i),h.append("documento_id",o.toString()),h.append("campus_id",v.ID_Campus),s.carreraId&&h.append("carrera_id",s.carreraId);for(let c of h.entries())c[1]instanceof File;const g=await fetch("/documentos/subir-archivo",{method:"POST",headers:{"X-CSRF-TOKEN":b||""},body:h}),f=await g.text();if(g.ok)try{const c=JSON.parse(f);if(!c.archivo||!c.archivo.estado){T("Error: El archivo no se procesó correctamente en el servidor"),oe(!1);return}F(100),T(`${i.name} subido exitosamente`),ue(x=>x+1),c.archivo.estado==="analizando"&&(T(`Analizando ${i.name} con IA...`),F(100),await new Promise(x=>setTimeout(x,2e3)));const _={id:c.archivo.id,nombre:i.name,tamaño:c.archivo.tamaño||i.size||0,fechaSubida:new Date().toISOString().split("T")[0],estado:c.archivo.estado==="analizando"?"analizando":"completado",progreso:100,mensaje:c.archivo.estado==="analizando"?"Analizando con IA...":"Completado"};B(x=>x.map(C=>p(C)===a?{...C,estado:"subido",archivos:[...q(C),_]}:C)),n&&p(n)===a&&D(x=>x&&{...x,estado:"subido",archivos:[...q(x),_]}),Be(x=>new Set(x).add(c.archivo.id)),setTimeout(()=>{Be(x=>{const C=new Set(x);return C.delete(c.archivo.id),C})},5e3),c.archivo.estado==="analizando"&&Ta(c.archivo.id,a,1),Ke()}catch{T("Error: El servidor devolvió una respuesta inválida"),oe(!1);return}else{try{const c=JSON.parse(f);c.validation_errors&&Object.keys(c.validation_errors).forEach(_=>{}),c.debug_info,T(`Error al subir ${i.name}: ${c.error||"Error desconocido"}`)}catch{T(`Error al subir ${i.name}: Error del servidor (${g.status})`)}F(0),await new Promise(c=>setTimeout(c,2e3))}}catch{T(`Error de conexión con ${i.name}`),F(0),N(!1),y(!0),he(!1),await new Promise(o=>setTimeout(o,2e3))}}me(!0),F(100),T(`Todos los archivos procesados exitosamente (${we+1}/${t.length})`),le(""),await new Promise(r=>setTimeout(r,3e3)),oe(!1),me(!1),F(0),T(""),le(""),ue(0),Ce(0)},[ze,Q]=u.useState(new Set),[Aa,Se]=u.useState(!1),[Ea,Je]=u.useState(!1),[Qe,xe]=u.useState([]),[H,W]=u.useState([]),[Ka,he]=u.useState(!1),[V,We]=u.useState("legales");u.useEffect(()=>()=>{Q(new Set)},[]),u.useEffect(()=>{v?.ID_Campus&&He(v.ID_Campus)},[v]),u.useEffect(()=>{if(v)if(V!=="medicos"&&(N(!0),y(!1)),W([]),V==="medicos")setTimeout(()=>{_e()},50),y(!0),N(!1);else{const a=z.filter(t=>!t.concepto.toLowerCase().includes("cartas de intención de campo clínico"));a.length>0&&D(a[0]),y(!0),N(!1)}},[V,v]),u.useEffect(()=>{if(V==="medicos"&&H.length>0)if(!n||!n.uniqueKey)D(H[0]);else{const a=H.find(t=>t.uniqueKey===n.uniqueKey);a&&a!==n&&D(a)}},[H,V]);const Ta=async(a,t,s=2)=>{if(ze.has(a))return;Q(d=>new Set(d).add(a));let r=0;const i=async()=>{r++;try{const d=await Ee(`/documentos/analisis/estado?archivo_id=${a}`,{method:"GET"});if(d.ok){const o=await d.json();if(B(b=>b.map(h=>{if(p(h)===t){const g=q(h).map(x=>{if(x.id===a){const C=o.tiene_analisis;let ge=C?"completado":"analizando",Y="";if(o.estado==="rechazado"||C&&o.analisis&&o.analisis.validacion&&!o.analisis.validacion.coincide){ge="rechazado";let $="";o.analisis&&o.analisis.validacion?$=o.analisis.validacion.razon:o.analisis&&o.analisis.documento?$=o.analisis.documento.observaciones:$="Documento no cumple con los requisitos",Y=`Documento rechazado: ${$}`;const fe=z.find(A=>p(A)===t);Ue({fileName:x.nombre,documentType:fe?.concepto||"Documento",reason:$,percentage:0,expectedType:o.analisis?.validacion?.documento_esperado||fe?.concepto||"Tipo de documento requerido",detectedType:o.analisis?.validacion?.documento_detectado||o.analisis?.documento?.nombre_detectado||o.documento?.tipo_detectado||"Tipo no identificado",cityValidation:o.analisis?.validacion?.ciudad_campus?{campusCity:o.analisis.validacion.ciudad_campus,documentCities:o.analisis.validacion.ciudades_documento||[],isValid:o.analisis.validacion.coincide||!1,details:o.analisis.validacion.evaluacion_gpt==="ciudad_incorrecta"?"El documento pertenece a una ciudad diferente a la del campus seleccionado":void 0}:void 0}),ne(!0)}else if(C&&o.analisis&&o.analisis.validacion){let $=`Documento validado correctamente (${o.analisis.validacion.porcentaje_coincidencia}% coincidencia)`;o.analisis.validacion.ciudad_campus&&o.analisis.validacion.ciudades_documento&&($+=` • Ubicación: ${o.analisis.validacion.ciudad_campus} ✓`),Y=$}else C?Y="Análisis IA completado":Y=`Analizando documento... (${r}/${s})`;return{...x,estado:ge,mensaje:Y,validacionIA:o.analisis?.validacion?{coincide:o.analisis.validacion.coincide,porcentaje:o.analisis.validacion.porcentaje_coincidencia,razon:o.analisis.validacion.razon,accion:o.analisis.validacion.accion}:void 0,fechaExpedicion:o.analisis?.documento?.fecha_expedicion,vigenciaDocumento:o.analisis?.documento?.vigencia_documento,diasRestantesVigencia:o.analisis?.documento?.dias_restantes_vigencia,metadata:o.metadata?{folio_documento:o.metadata.folio_documento,fecha_expedicion:o.metadata.fecha_expedicion,vigencia_documento:o.metadata.vigencia_documento,lugar_expedicion:o.metadata.lugar_expedicion,estado_bd:o.metadata.estado_bd||o.estado_bd}:void 0}}return x});let f=h.estado;const c=g.find(x=>x.estado==="completado"&&(!x.validacionIA||x.validacionIA.coincide));return g.find(x=>x.estado==="rechazado"||x.estado==="completado"&&x.validacionIA&&!x.validacionIA.coincide)?f="rechazado":c?f="vigente":g.some(x=>x.estado==="completado")&&(f="subido"),{...h,estado:f,archivos:g}}return h})),n&&p(n)===t&&D(b=>{if(b&&z.find(g=>p(g)===t)){const g=o.estado==="rechazado"||o.analisis?.validacion&&!o.analisis.validacion.coincide;return{...b,estado:g?"rechazado":o.analisis?.validacion?.coincide?"vigente":b.estado,archivos:b.archivos?.map(c=>{if(c.id===a){const _=g?"rechazado":o.tiene_analisis?"completado":"analizando";return{...c,estado:_,validacionIA:o.analisis?.validacion?{coincide:o.analisis.validacion.coincide,porcentaje:o.analisis.validacion.porcentaje_coincidencia,razon:o.analisis.validacion.razon,accion:o.analisis.validacion.accion}:void 0,fechaExpedicion:o.analisis?.documento?.fecha_expedicion,vigenciaDocumento:o.analisis?.documento?.vigencia_documento,diasRestantesVigencia:o.analisis?.documento?.dias_restantes_vigencia}}return c})||[]}}return b}),o.tiene_analisis||r>=s){if(Q(b=>{const h=new Set(b);return h.delete(a),h}),o.tiene_analisis){const b=z.find(f=>p(f)===t),h=b?.archivos?.find(f=>f.id===a);if(o.estado==="rechazado"||o.analisis&&o.analisis.validacion&&!o.analisis.validacion.coincide)setTimeout(()=>{B(f=>[...f])},100);else if(o.analisis?.validacion?.coincide){const f=b?.archivos?.find(c=>c.id===a);fa(`${f?.nombre||"Documento"} validado exitosamente`),De(!0),setTimeout(()=>De(!1),4e3),setTimeout(()=>{D(c=>c&&{...c})},500)}Ke()}!o.tiene_analisis&&r>=s&&B(b=>b.map(h=>{if(p(h)===t){const g=q(h).map(f=>f.id===a?{...f,estado:"error"}:f);return{...h,archivos:g}}return h}));return}setTimeout(i,2e3)}else r<s?setTimeout(i,2e3):Q(o=>{const b=new Set(o);return b.delete(a),b})}catch{r<s?setTimeout(i,3e3):Q(o=>{const b=new Set(o);return b.delete(a),b})}};i()},$a=()=>{Q(new Set),B(a=>a.map(t=>({...t,archivos:q(t).map(s=>s.estado==="analizando"?{...s,estado:"error"}:s)})))},Ye=a=>{const t=new Date,r=new Date(a).getTime()-t.getTime();return Math.ceil(r/(1e3*60*60*24))},Ra=a=>a<0?"text-red-600":a<=7?"text-orange-600":a<=30?"text-yellow-600":"text-green-600",w=a=>a.toLowerCase(),k=a=>{const t=S(a),s=w(t);if(s==="caducado")return!0;const r=Pe(a),i=r.diasRestantes!==null?r.diasRestantes:Ye(a.fechaLimite),d=s==="vigente"&&i<0;return d&&console.log("⏰ Documento caducado dinámicamente:",a.concepto,"Días restantes:",i),d},Ze=a=>{const t=S(a);if(k(a))return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-300 dark:border-orange-800";const s=w(t);return Oa(s)},ea=a=>{if(k(a))return e.jsx(J,{className:"w-3 h-3"});const t=S(a),s=w(t);return Ua(s)},aa=a=>{if(k(a))return"caducado";const t=S(a);return w(t)},S=a=>{const s=q(a).filter(r=>r.metadata?.estado_bd);return s.length>0&&s.sort((i,d)=>new Date(d.fechaSubida).getTime()-new Date(i.fechaSubida).getTime())[0].metadata?.estado_bd||a.estado},sa=z.filter(a=>{const t=a.concepto.toLowerCase().includes(re.toLowerCase())||a.descripcion.toLowerCase().includes(re.toLowerCase());let s=!1;const r=w(a.estado);return M==="todos"?s=!0:M==="subido"?s=r==="subido"||r==="vigente"||r==="caducado"||k(a):s=r===M||M==="caducado"&&k(a),t&&s}),G=(()=>{if(V==="legales")return sa.filter(a=>!a.concepto.toLowerCase().includes("cartas de intención de campo clínico"));{if(H.length>0)return console.log("🔄 Usando documentos médicos con estado actualizado:",H.length),H.filter(s=>{const r=s.concepto.toLowerCase().includes(re.toLowerCase())||s.descripcion.toLowerCase().includes(re.toLowerCase());let i=!1;const d=w(s.estado);return M==="todos"?i=!0:M==="subido"?i=d==="subido"||d==="vigente"||d==="caducado"||k(s):i=d===M||M==="caducado"&&k(s),r&&i});const a=sa.filter(s=>s.concepto.toLowerCase().includes("cartas de intención de campo clínico"));if(a.length===0||Qe.length===0)return[];const t=[];return Qe.forEach(s=>{a.forEach(r=>{const i=`${r.id}_carrera_${s.ID_Especialidad}`,d={id:r.id,concepto:`${r.concepto} - ${s.Descripcion}`,descripcion:`${r.descripcion} para la carrera de ${s.Descripcion}`,fechaLimite:r.fechaLimite,estado:"pendiente",archivos:[],obligatorio:r.obligatorio,categoria:r.categoria,documentoOriginalId:r.id,uniqueKey:i,carreraId:String(s.ID_Especialidad),carreraNombre:s.Descripcion};t.push(d)})}),t}})();return e.jsxs(Pa,{breadcrumbs:[{title:"Dashboard",href:"/dashboard"},{title:"Documentos",href:"/documentos"},{title:"Subir Documentos",href:"/documentos/upload"}],children:[e.jsx(Fa,{title:"Subida de Documentos",children:e.jsx("meta",{name:"csrf-token",content:document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""})}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[ha&&e.jsx("div",{className:"fixed top-4 right-4 z-40 animate-in slide-in-from-right-full duration-500",children:e.jsx(R,{className:"bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Archivo subido exitosamente"}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:ga})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>De(!1),className:"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200 hover:bg-green-100 dark:hover:bg-green-900/50 h-6 w-6 p-0",children:e.jsx(pe,{className:"w-3 h-3"})})]})})})}),la&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50",onClick:a=>a.preventDefault(),children:e.jsx(R,{className:"w-96 mx-4 dark:bg-gray-800 dark:border-gray-700",onClick:a=>a.stopPropagation(),children:e.jsx(I,{className:"p-8",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"relative",children:K?e.jsxs("div",{className:"w-16 h-16 mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-12 h-12 text-green-600 animate-pulse"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-green-600 rounded-full opacity-20 animate-ping"})})]}):e.jsxs("div",{className:"w-16 h-16 mx-auto",children:[e.jsx(ee,{className:"w-16 h-16 text-blue-600 animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full opacity-20 animate-ping"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:`text-lg font-semibold ${K?"text-green-900 dark:text-green-100":"text-gray-900 dark:text-gray-100"}`,children:K?"Documentos Subidos Exitosamente":"Procesando Documentos"}),Le&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Le}),e.jsx("p",{className:`text-sm font-medium ${K?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:ma}),K&&we>0&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[e.jsx(U,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:[we," de ",ua," archivo(s) procesado(s) exitosamente"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"Progreso"}),e.jsxs("span",{children:[Ve,"%"]})]}),e.jsx(ta,{value:Ve,className:`h-3 ${K?"bg-green-100 dark:bg-green-900/30":"dark:bg-gray-700"}`})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:K?"Los documentos se están procesando en segundo plano...":"Por favor espera mientras procesamos tus documentos..."}),K&&e.jsxs(E,{onClick:()=>{oe(!1),me(!1),F(0),T(""),le(""),ue(0),Ce(0)},className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Continuar"]})]})})})}),ba&&O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",onClick:a=>a.preventDefault(),children:e.jsxs(R,{className:"w-full max-w-2xl bg-white dark:bg-gray-800 shadow-xl dark:border-gray-700",onClick:a=>a.stopPropagation(),children:[e.jsx(be,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(je,{className:"text-lg text-gray-900 dark:text-gray-100",children:"Documento Rechazado"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Validación automática"})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>ne(!1),className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 h-8 w-8 p-0",children:e.jsx(pe,{className:"w-4 h-4"})})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Archivo:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg",children:O.fileName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Motivo:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border-l-4 border-red-400 dark:border-red-600",children:O.reason})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Esperado:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900/20 p-2 rounded text-center",children:O.expectedType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Detectado:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 bg-orange-50 dark:bg-orange-900/20 p-2 rounded text-center",children:O.detectedType})]})]}),O.cityValidation&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Validación de Ubicación:"}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Campus:"}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white p-2 rounded border",children:["📍 ",O.cityValidation.campusCity]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Documento de:"}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white p-2 rounded border",children:["🏙️ ",O.cityValidation.documentCities.join(", ")||"No detectado"]})]})]}),O.cityValidation.details&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-yellow-800",children:[e.jsx(L,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:O.cityValidation.details})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"¿Qué hacer?"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Suba el documento correcto o contacte al administrador si considera que es un error."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(E,{variant:"outline",onClick:()=>ne(!1),className:"flex-1",children:"Cerrar"}),e.jsxs(E,{onClick:()=>{ne(!1),(n?document.getElementById(`file-input-${p(n)}`):null)?.scrollIntoView({behavior:"smooth"})},className:"flex-1",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Subir Documento Correcto"]})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2 dark:text-gray-100",children:"Subir Documentos"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400",children:"Selecciona un campus y un documento de la lista para subir los archivos requeridos"})]}),ze.size>0&&e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin"}),e.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:[ze.size," análisis en curso"]})]}),e.jsxs(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-blue-700 dark:text-blue-300 hover:text-blue-900 dark:hover:text-blue-100 hover:bg-blue-100 dark:hover:bg-blue-900/50",onClick:$a,children:[e.jsx(pe,{className:"w-3 h-3 mr-1"}),"Detener"]})]})]})}),(!l||!Array.isArray(l)||l.length===0)&&e.jsx(R,{className:"mb-6 border-destructive",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("p",{className:"font-medium",children:P||"No tienes campus asignados para subir documentos"})]})})}),v&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[e.jsx(R,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Total ",V==="medicos"?"Médicos":"Legales"]}),e.jsx("p",{className:"text-2xl font-bold",children:G.length})]})]})})}),e.jsx(R,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>w(a.estado)==="pendiente").length})]})]})})}),e.jsx(R,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Completados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>w(a.estado)==="vigente"&&!k(a)).length})]})]})})}),e.jsx(R,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Caducados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>w(a.estado)==="caducado"||k(a)).length})]})]})})}),e.jsx(R,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rechazados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>w(a.estado)==="rechazado").length})]})]})})})]}),v&&e.jsxs(e.Fragment,{children:[Oe&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(R,{className:"h-fit",children:[e.jsx(be,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(je,{className:"text-lg",children:"Documentos Requeridos"}),l&&Array.isArray(l)&&l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{htmlFor:"campus-select",className:"text-sm font-medium text-muted-foreground",children:"Campus:"}),e.jsxs($e,{value:v?.ID_Campus||"",onValueChange:Ge,children:[e.jsx(Re,{className:"w-52",children:e.jsx(Ie,{placeholder:"Selecciona campus"})}),e.jsx(Fe,{children:[...l].sort((a,t)=>a.Campus.localeCompare(t.Campus,"es",{sensitivity:"base"})).map(a=>e.jsx(ve,{value:a.ID_Campus,children:a.Campus},a.ID_Campus))})]})]})]})}),e.jsx(I,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ee,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Cargando Documentos"}),e.jsx("p",{className:"text-sm text-gray-500",children:V==="medicos"?"Obteniendo estados de documentos médicos...":"Obteniendo documentos legales..."})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(R,{className:"h-fit",children:e.jsx(I,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto",children:e.jsx(X,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-300",children:"Preparando Información"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Por favor espera mientras cargamos la información completa..."})]})]})})})})]}),!Oe&&pa&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(R,{className:"h-fit",children:[e.jsxs(be,{className:"pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(je,{className:"text-lg",children:"Documentos Requeridos"}),l&&Array.isArray(l)&&l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{htmlFor:"campus-select",className:"text-sm font-medium text-muted-foreground",children:"Campus:"}),e.jsxs($e,{value:v?.ID_Campus||"",onValueChange:Ge,children:[e.jsx(Re,{className:"w-52",children:e.jsx(Ie,{placeholder:"Selecciona campus"})}),e.jsx(Fe,{children:[...l].sort((a,t)=>a.Campus.localeCompare(t.Campus,"es",{sensitivity:"base"})).map(a=>e.jsx(ve,{value:a.ID_Campus,children:a.Campus},a.ID_Campus))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"text-sm font-medium text-muted-foreground",children:"Tipo:"}),e.jsxs($e,{value:V,onValueChange:a=>{We(a)},children:[e.jsx(Re,{className:"w-40",children:e.jsx(Ie,{})}),e.jsxs(Fe,{children:[e.jsx(ve,{value:"legales",children:"Legales"}),Aa&&e.jsx(ve,{value:"medicos",children:"Médicos"})]})]}),Ea&&e.jsx(ee,{className:"w-4 h-4 animate-spin text-blue-500"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ba,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ma,{placeholder:"Buscar documento...",value:re,onChange:a=>da(a.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:M==="todos"?"default":"outline",size:"sm",onClick:()=>ke("todos"),children:"Todos"}),e.jsx(E,{variant:M==="pendiente"?"default":"outline",size:"sm",onClick:()=>ke("pendiente"),children:"Pendientes"}),e.jsx(E,{variant:M==="subido"?"default":"outline",size:"sm",onClick:()=>ke("subido"),children:"Subidos"})]})]})]})]}),e.jsx(I,{className:"p-0",children:e.jsx("div",{ref:de,className:"max-h-[600px] overflow-y-auto",children:G.map(a=>{const t=a.uniqueKey||a.id,s=n?.uniqueKey===t||n?.id===a.id&&!a.uniqueKey;return e.jsxs("div",{className:`p-4 border-b cursor-pointer transition-colors hover:bg-muted/50 ${s?"bg-primary/10 border-l-4 border-l-primary":""}`,onClick:r=>{r.preventDefault();const i=de.current?.scrollTop||0;D(a),requestAnimationFrame(()=>{de.current&&(de.current.scrollTop=i)})},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2",children:a.concepto}),a.obligatorio&&e.jsx(Z,{variant:"destructive",className:"text-xs ml-2",children:"Req."})]}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(Z,{className:Ze(a),variant:"outline",children:[ea(a),e.jsx("span",{className:"ml-1 capitalize text-xs",children:aa(a)})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(J,{className:"w-3 h-3"}),(()=>{const r=Pe(a),d=(r.diasRestantes!==null?r.diasRestantes:Ye(a.fechaLimite))??0;return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:Ne(r.fecha)}),e.jsxs("span",{className:`font-medium ${Ra(d)}`,children:["(",d>=0?`${d}d`:`${Math.abs(d)}d vencido`,")"]})]})})()]})]},t)})})})]})}),e.jsx("div",{className:"lg:col-span-2",children:n?e.jsxs(R,{className:"h-fit dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs(be,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(je,{className:"text-xl dark:text-gray-100",children:n.concepto}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 mt-1",children:n.descripcion})]}),e.jsx(Z,{className:Ze(n),children:e.jsxs("div",{className:"flex items-center gap-1",children:[ea(n),e.jsx("span",{className:"capitalize",children:aa(n)})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm pt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground dark:text-gray-400",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{children:["Vence: ",Ne(Pe(n).fecha)]})]}),n.obligatorio&&e.jsx(Z,{variant:"destructive",className:"text-xs",children:"Documento Obligatorio"}),k(n)&&e.jsx(Z,{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-300 dark:border-orange-800",children:"CADUCADO"}),n?.carreraNombre&&e.jsx(Z,{variant:"secondary",className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400",children:n.carreraNombre})]})]}),e.jsxs(I,{className:"space-y-6",children:[q(n).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 dark:text-gray-200",children:["Archivos subidos (",q(n).length,")"]}),e.jsx("div",{className:"space-y-2",children:q(n).map(a=>{const t=n?.estado==="rechazado"||a.validacionIA&&!a.validacionIA.coincide,s=k(n);let r="";return xa.has(a.id)?r="border-green-400 dark:border-green-600 bg-green-50 dark:bg-green-900/20 shadow-lg ring-2 ring-green-200 dark:ring-green-800 ring-opacity-50 animate-pulse":a.estado==="subiendo"||a.estado==="procesando"||a.estado==="analizando"?r="border-blue-300 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/20 shadow-lg":a.estado==="completado"?t?r="border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":s?r="border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20":r="border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":a.estado==="rechazado"?r="border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20 shadow-lg":a.estado==="error"?r="border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":r="border-gray-200 dark:border-gray-700 dark:bg-gray-800/50",e.jsx("div",{className:`p-3 border rounded-lg transition-all duration-300 ${r}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-3 flex-1",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium dark:text-gray-200",children:a.nombre}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:oa(a)}),"                                                                    ",a.estado==="subiendo"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-bounce"}),e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:a.mensaje||"Subiendo archivo..."}),e.jsxs("span",{className:"text-xs text-blue-500 dark:text-blue-400 font-bold",children:[a.progreso,"%"]})]}),e.jsx(ta,{value:a.progreso,className:"h-3 bg-blue-100 dark:bg-blue-900/30"})]}),a.estado==="procesando"&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 animate-spin"}),e.jsx("span",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-300",children:a.mensaje||"Procesando documento..."})]})}),a.estado==="analizando"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ca,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:a.mensaje||"Analizando con IA..."})]}),e.jsx("div",{className:"mt-1 text-xs text-purple-600 dark:text-purple-400",children:e.jsx("div",{className:"mt-1 text-xs text-purple-600 dark:text-purple-400",children:"procesando el documento..."})})]}),a.estado==="completado"&&e.jsxs(e.Fragment,{children:[(()=>{const i=n?.estado==="rechazado"||a.validacionIA&&!a.validacionIA.coincide,d=k(n);return i?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:"Documento Rechazado"}),a.validacionIA&&e.jsxs("span",{className:"text-xs bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400 px-2 py-1 rounded",children:["No aprobado (",a.validacionIA.porcentaje,"%)"]})]}):d?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(J,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"Documento Caducado"}),e.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 px-2 py-1 rounded",children:"Vencido - Requiere Renovación"})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(U,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Documento Vigente"}),a.validacionIA&&e.jsxs("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 px-2 py-1 rounded",children:["Aprobado (",a.validacionIA.porcentaje,"%)"]})]})})(),e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Vista Previa del Documento"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.nombre})]})]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>window.open(`/documentos/file/${a.file_hash_sha256}`,"_blank"),className:"gap-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm",children:[e.jsx(ra,{className:"w-4 h-4"}),"Abrir Completo"]})]})}),e.jsxs("div",{className:"relative bg-gray-50 dark:bg-gray-900",children:[e.jsx("iframe",{src:`/documentos/archivo/${a.id}#toolbar=1&navpanes=0&scrollbar=1&view=FitH&zoom=125`,className:"w-full h-[700px] bg-white dark:bg-gray-900",title:`Preview de ${a.nombre}`,style:{backgroundColor:"#ffffff",border:"none",borderRadius:"0"},onError:()=>{console.log("Error cargando preview del PDF")},loading:"lazy",allowFullScreen:!0}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-all duration-300 pointer-events-none",children:e.jsxs("div",{className:"text-center text-white bg-gray-900 dark:bg-gray-800 bg-opacity-80 p-6 rounded-lg backdrop-blur-sm",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Documento PDF Validado"}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Haz clic para abrir en una nueva ventana"}),e.jsxs(E,{variant:"secondary",onClick:()=>window.open(`/documentos/file/${a.file_hash_sha256}`,"_blank"),className:"gap-2 pointer-events-auto bg-white text-gray-900 hover:bg-gray-100",children:[e.jsx(ra,{className:"w-4 h-4"}),"Ver en Nueva Ventana"]})]})})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:e.jsx("div",{className:"flex items-center gap-4 text-xs",children:e.jsx("span",{children:oa(a)})})})})]})]}),a.estado==="rechazado"&&e.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-700",children:"Documento Rechazado"})]}),a.validacionIA&&e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>ya(a,n.concepto),className:"text-red-600 hover:text-red-800 hover:bg-red-100 h-6 px-2",children:e.jsx("span",{className:"text-xs",children:"Ver detalles"})})]}),a.validacionIA&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium mb-1",children:"Motivo del rechazo:"}),e.jsx("p",{className:"text-xs text-red-700",children:a.validacionIA.razon}),a.validacionIA.porcentaje!==void 0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Coincidencia: ",a.validacionIA.porcentaje,"%"]})]})]}),a.estado==="error"&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-700",children:a.mensaje||"Error en proceso"})]})]})})})},a.id)})})]}),(se[p(n)]||[]).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 dark:text-gray-200",children:["Archivos seleccionados (",(se[p(n)]||[]).length,")"]}),e.jsx("div",{className:"space-y-2",children:(se[p(n)]||[]).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary/5 dark:bg-primary/10 rounded-lg border border-primary/20 dark:border-primary/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium dark:text-gray-200",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:Me(a.size)})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>za(p(n),t),className:"text-destructive hover:text-destructive dark:text-red-400 dark:hover:text-red-300",children:e.jsx(pe,{className:"w-4 h-4"})})]},t))}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(E,{onClick:()=>Sa(p(n)),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Subir Archivos (",(se[p(n)]||[]).length,")"]}),e.jsx(E,{variant:"outline",onClick:()=>te(a=>({...a,[p(n)]:[]})),children:"Cancelar"})]})]}),(w(S(n))!=="vigente"||k(n))&&ja(n)?e.jsxs("div",{className:`
                                                border-2 border-dashed rounded-lg p-8 text-center transition-colors
                                                ${qe===p(n)?"border-primary bg-primary/5 dark:bg-primary/10":"border-muted-foreground/25 hover:border-muted-foreground/50 dark:border-gray-700 dark:hover:border-gray-600"}
                                            `,onDragOver:a=>wa(a,p(n)),onDragLeave:Ca,onDrop:a=>Da(a,p(n)),children:[e.jsx(ae,{className:`
                                                w-12 h-12 mx-auto mb-4
                                                ${qe===p(n)?"text-primary":"text-muted-foreground dark:text-gray-400"}
                                            `}),e.jsx("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Arrastra archivos aquí"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 mb-4 text-sm",children:"o haz clic para seleccionar archivos"}),e.jsx("input",{type:"file",id:`file-input-${p(n)}`,className:"hidden",multiple:!0,accept:".pdf",onChange:a=>_a(a,p(n))}),e.jsxs(E,{variant:"outline",onClick:()=>{document.getElementById(`file-input-${p(n)}`)?.click()},children:[e.jsx(Va,{className:"w-4 h-4 mr-2"}),"Seleccionar Archivos"]}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400 mt-3",children:"Formatos: PDF"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-8 text-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:w(S(n))==="vigente"&&!k(n)?e.jsx(U,{className:"w-12 h-12 text-green-600 dark:text-green-400"}):w(S(n))==="rechazado"?e.jsx(L,{className:"w-12 h-12 text-red-600 dark:text-red-400"}):w(S(n))==="caducado"||k(n)?e.jsx(J,{className:"w-12 h-12 text-orange-600 dark:text-orange-400"}):e.jsx(L,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-700 dark:text-gray-200",children:w(S(n))==="vigente"&&!k(n)?"Documento Aprobado":w(S(n))==="rechazado"?"Documento Rechazado - Puede Subir Nuevo":w(S(n))==="caducado"||k(n)?"Documento Caducado - Puede Subir Nuevo":"Subida Bloqueada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:ka(n)}),w(S(n))==="vigente"&&!k(n)&&e.jsxs("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg p-3 text-green-800 dark:text-green-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento ha sido validado y aprobado."}),e.jsx("p",{className:"text-xs mt-1 text-green-700 dark:text-green-400",children:"No se pueden realizar más cambios a menos que sea rechazado por un administrador."})]}),w(S(n))==="rechazado"&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3 text-red-800 dark:text-red-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento fue rechazado por un administrador."}),e.jsx("p",{className:"text-xs mt-1 text-red-700 dark:text-red-400",children:"Por favor, revise los comentarios y suba una nueva versión."})]}),(w(S(n))==="caducado"||k(n))&&e.jsxs("div",{className:"bg-orange-100 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-3 text-orange-800 dark:text-orange-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento ha caducado por vencimiento de fecha."}),e.jsx("p",{className:"text-xs mt-1 text-orange-700 dark:text-orange-400",children:"Puede subir una nueva versión actualizada del documento."})]})]})]})]}):e.jsx(R,{className:"h-full dark:bg-gray-800 dark:border-gray-700",children:e.jsx(I,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-12 h-12 text-muted-foreground dark:text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Selecciona un documento"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 text-sm",children:"Elige un documento de la lista para comenzar a subir archivos"})]})})})})]})]})]})]})};export{gs as default};
