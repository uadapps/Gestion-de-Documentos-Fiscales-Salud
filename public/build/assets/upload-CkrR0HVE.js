import{a as m,j as e,H as Fa,c as Ee}from"./app-D8A6MmTC.js";import{A as Pa,X as fe,U as ae}from"./app-layout-KA4ZYzCR.js";import{C as I,c as R,a as pe,b as be}from"./card-D2pZnewG.js";import{B as E}from"./button-BGV-kG6u.js";import{B as Z}from"./badge-FcV8ZrTE.js";import{P as ta}from"./progress-BTEMd5dR.js";import{I as Ma}from"./input-DFZSo60i.js";import{L as Te}from"./label-Dqcp-y-1.js";import{S as $e,a as Ie,b as Re,c as Fe,d as je}from"./select-CyjxAQg-.js";import{C as U,F as X}from"./file-text-CTmfoya1.js";import{L as ee}from"./loader-circle-HYc-0y3A.js";import{C as L}from"./circle-alert-BY2ZZROe.js";import{C as oa}from"./clock-DnEOvGvT.js";import{C as J}from"./calendar-oJE7Y2Lc.js";import{c as ia}from"./createLucideIcon-B7odIqhP.js";import{B as ca}from"./brain-DsVe7M7g.js";import{E as ra}from"./eye-BZ-BmRRn.js";/* empty css            */import"./index-C_HFOC-c.js";import"./index-F78BPGYV.js";import"./index-DW9AIAM8.js";import"./log-out-DqFEyMac.js";import"./check-CzNkaTRq.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Va=ia("Plus",qa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Ba=ia("Search",La),Oa=l=>{switch(l){case"pendiente":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";case"subido":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"vigente":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 border-green-200 dark:border-green-800";case"caducado":return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-200 dark:border-orange-800";case"rechazado":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400 border-red-200 dark:border-red-800";default:return"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-700"}},Ua=l=>{switch(l){case"pendiente":return e.jsx(oa,{className:"w-4 h-4"});case"subido":return e.jsx(ae,{className:"w-4 h-4"});case"vigente":return e.jsx(U,{className:"w-4 h-4"});case"caducado":return e.jsx(J,{className:"w-4 h-4"});case"rechazado":return e.jsx(L,{className:"w-4 h-4"});case"subiendo":return e.jsx(ae,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-pulse"});case"procesando":return e.jsx(ee,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 animate-spin"});case"analizando":return e.jsx(ca,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-pulse"});case"completado":return e.jsx(U,{className:"w-4 h-4 text-green-600 dark:text-green-400"});case"error":return e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"});default:return e.jsx(X,{className:"w-4 h-4"})}},Me=l=>{if(!l||l===0||isNaN(l))return"0 Bytes";const x=1024,z=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(l)/Math.log(x));return parseFloat((l/Math.pow(x,P)).toFixed(2))+" "+z[P]},ve=l=>{if(!l)return"Fecha no disponible";try{let x;if(l.includes("-"))if(l.match(/^\d{4}-\d{2}-\d{2}$/)){const[z,P,j]=l.split("-");x=new Date(parseInt(z),parseInt(P)-1,parseInt(j))}else x=new Date(l);else isNaN(Number(l))?x=new Date(l):x=new Date(Number(l));return isNaN(x.getTime())?"Fecha inválida":x.toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"})}catch(x){return console.error("Error formateando fecha:",l,x),"Fecha inválida"}},na=l=>{const x=l.fechaExpedicion,z=l.vigenciaDocumento;if(l.diasRestantesVigencia,!x&&!z)return`${Me(l.tamaño||0)} • ${ve(l.fechaSubida)}`;let P=Me(l.tamaño||0);return x&&(P+=` • ${ve(x)}`),P},Pe=l=>{const x=l.archivos?.find(z=>z.estado==="completado"&&(z.metadata?.vigencia_documento||z.vigenciaDocumento));if(x){const z=x.metadata?.vigencia_documento||x.vigenciaDocumento;if(z){const P=new Date(z),j=new Date,Ne=P.getTime()-j.getTime(),ie=Math.ceil(Ne/(1e3*60*60*24));return{fecha:z,diasRestantes:ie,esVigenciaReal:!0}}}return{fecha:l.fechaLimite,diasRestantes:null,esVigenciaReal:!1}},gs=({campusDelDirector:l,documentosRequeridos:x,campusSeleccionado:z,error:P})=>{const[j,Ne]=m.useState(z),ie=(x||[]).map(a=>({...a,archivos:a.archivos||[]})),[_,O]=m.useState(ie),[qe,ye]=m.useState(null),[se,te]=m.useState({}),[o,C]=m.useState(ie[0]||null),[M,ke]=m.useState("todos"),ce=m.useRef(null),[re,da]=m.useState(""),[la,ne]=m.useState(!1),[Ve,F]=m.useState(0),[ma,T]=m.useState(""),[Le,de]=m.useState(""),[K,le]=m.useState(!1),[we,me]=m.useState(0),[ua,Ce]=m.useState(0),[xa,Be]=m.useState(new Set),[ha,De]=m.useState(!1),[ga,fa]=m.useState(""),[Oe,v]=m.useState(!1),[pa,N]=m.useState(!1),[ba,oe]=m.useState(!1),[B,Ue]=m.useState(null),p=a=>a.uniqueKey||a.id,q=a=>a.archivos||[],ja=a=>{const r=q(a);if(r.length===0)return!0;const s=S(a),t=k(s);return t==="vigente"&&!y(a)?!1:t==="caducado"||y(a)?!0:!(r.find(d=>d.estado==="completado"&&(!d.validacionIA||d.validacionIA.coincide))&&s!=="rechazado")},ze=async()=>{if(j)try{V==="medicos"?await Na():await va()}catch(a){console.error("Error al refrescar documentos:",a),v(!1),N(!0),xe(!1)}},va=async()=>{if(j)try{v(!0),N(!1);const a=await fetch(`/documentos/upload?campus=${j.ID_Campus}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(a.ok){const r=await a.json();if(r.props?.documentosRequeridos){const s=(r.props.documentosRequeridos||[]).map(t=>({...t,archivos:t.archivos||[]}));if(O(s),o){const t=s.find(i=>i.id===o.id);t&&C(t)}else s.length>0&&C(s[0]);N(!0),v(!1)}else v(!1),N(!0)}else console.error("Error al actualizar documentos legales:",a.status,a.statusText),v(!1),N(!0)}catch(a){console.error("Error en refrescarDocumentosLegales:",a),v(!1),N(!0)}},Na=async()=>{if(j){v(!0),N(!1),xe(!0);try{const a=Date.now(),r=await fetch(`/documentos/medicos-con-sp?campus_id=${j.ID_Campus}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!r.ok)throw new Error(`Error en la respuesta: ${r.status}`);const s=await r.json(),t=Date.now()-a;if(!s.success||!s.carreras_medicas){W([]);return}const i=s.carreras_medicas,d=s.documentos_agrupados||[],n=s.documentos_detalle||{};ue(i);const b=_.filter(g=>g.concepto.toLowerCase().includes("cartas de intención de campo clínico"));if(b.length===0){W([]);return}if(!i||i.length===0){W([]);return}const h=[];if(d&&d.length>0?d.forEach((g,f)=>{const c=g.carrera_nombre;let D=null;const u=n[c]||[];if(u.length>0&&u[0].carrera_id?D=u[0].carrera_id:D=i.find(Ra=>Ra.Descripcion===c)?.ID_Especialidad,!D){console.error(`❌ No se pudo obtener carrera_id para "${c}". Saltando...`);return}const w=b[0],he=`${w.id}_carrera_${D}`,Ae=(n[c]||[]).filter(A=>A.archivo_id).map(A=>({id:A.archivo_id.toString(),nombre:A.nombre_documento||A.folio_documento||"Documento médico",tamaño:null,fechaSubida:A.subido_en||new Date().toISOString().split("T")[0],estado:"completado",progreso:100,fechaExpedicion:A.fecha_expedicion,vigenciaDocumento:A.vigencia_documento,diasRestantesVigencia:A.dias_restantes_vigencia,metadata:{folio_documento:A.folio_documento,fecha_expedicion:A.fecha_expedicion,vigencia_documento:A.vigencia_documento,estado_bd:A.estado_final}}));let $="pendiente";Ae.length>0?g.Vigentes>0?$="vigente":g.Caducados>0?$="caducado":g.Rechazados>0&&($="rechazado"):$="pendiente";const ge={...w,id:w.id,documentoOriginalId:w.id,uniqueKey:he,concepto:`${w.concepto} - ${c}`,descripcion:`${w.descripcion} para la carrera de ${c}`,carreraId:String(D),carreraNombre:c,estado:$,archivos:Ae};h.push(ge)}):i.forEach(g=>{const f=g.ID_Especialidad,c=g.Descripcion;b.forEach(D=>{const u=`${D.id}_carrera_${f}`,w={...D,id:D.id,documentoOriginalId:D.id,uniqueKey:u,concepto:`${D.concepto} - ${c}`,descripcion:`${D.descripcion} para la carrera de ${c}`,carreraId:String(f),carreraNombre:c,estado:"pendiente",archivos:[]};h.push(w)})}),W(h),o&&V==="medicos"){const g=h.find(f=>f.uniqueKey===o.uniqueKey||f.carreraNombre===o.carreraNombre&&f.documentoOriginalId===o.documentoOriginalId);g?C(g):h.length>0&&C(h[0])}else!o&&h.length>0&&C(h[0])}catch{W([])}finally{N(!0),v(!1),xe(!1)}}},Ke=()=>{setTimeout(()=>{ze()},2e3)};m.useEffect(()=>{v(!0),N(!1);const a=x?.every(s=>!s.archivos||s.archivos.length===0)||!1,r=!x||x.length===0;if(z&&(r||a))(async()=>{try{const t=await fetch("/documentos/cambiar-campus",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({campus_id:z.ID_Campus})});if(t.ok){const i=await t.json();if(i.documentos){const d=(i.documentos||[]).map(n=>({...n,archivos:n.archivos||[]}));O(d),d.length>0&&C(d[0]),N(!0),v(!1)}else v(!1),N(!0)}else v(!1),N(!0)}catch{v(!1),N(!0)}})();else if(z&&x&&x.length>0&&!a){if(!o&&_.length>0)C(_[0]);else if(!o&&x.length>0){const s={...x[0],archivos:x[0].archivos||[]};C(s)}N(!0),v(!1)}else if(x&&x.length>0){const s=x.map(t=>({...t,archivos:t.archivos||[]}));O(s),!o&&s.length>0&&C(s[0]),N(!0),v(!1)}else v(!1),N(!0)},[]),m.useEffect(()=>{_.length>0&&_.forEach((a,r)=>{(a.archivos?.length||0)>0&&a.archivos?.forEach((t,i)=>{})}),_.length>0&&!o&&C(_[0])},[_,o]),m.useEffect(()=>{_.flatMap(r=>(r.archivos||[]).filter(s=>s.estado==="completado"&&!s.fechaExpedicion&&!s.vigenciaDocumento)).forEach(r=>{})},[_]),m.useEffect(()=>{if(o){const a=_.find(r=>p(r)===p(o));a&&a.archivos?.some((s,t)=>{const i=o.archivos?.[t];return i&&(s.fechaExpedicion!==i.fechaExpedicion||s.vigenciaDocumento!==i.vigenciaDocumento||s.diasRestantesVigencia!==i.diasRestantesVigencia)})&&C(a)}},[_]),m.useEffect(()=>{j&&j.ID_Campus&&_.length===0&&ze()},[j]);const ya=(a,r)=>{a.validacionIA&&!a.validacionIA.coincide&&(Ue({fileName:a.nombre,documentType:r,reason:a.validacionIA.razon||"Documento no válido",percentage:a.validacionIA.porcentaje||0,expectedType:r,detectedType:"Información de análisis IA"}),oe(!0))},ka=a=>{const r=q(a);if(r.length===0)return"No hay archivos subidos para este documento";const s=S(a),t=k(s);return t==="rechazado"?"El documento fue rechazado por un administrador. Puede subir un nuevo archivo.":t==="caducado"||y(a)?"El documento ha caducado por vencimiento de fecha. Puede subir un nuevo archivo.":t==="vigente"&&!y(a)?"Documento aprobado por administrador. No se pueden subir más archivos.":r.find(n=>n.estado==="completado"&&(!n.validacionIA||n.validacionIA.coincide))?"Documento validado automáticamente por IA. Esperando revisión del administrador.":r.find(n=>n.estado==="rechazado"||n.validacionIA&&!n.validacionIA.coincide)?"El documento anterior fue rechazado por validación automática. Puede subir un nuevo archivo.":"Puede subir archivos para este documento"},Ge=async a=>{v(!0),N(!1);try{const r=await Ee("/documentos/cambiar-campus",{method:"POST",body:JSON.stringify({campus_id:a})});if(r.ok){const s=await r.json();Ne(s.campus);const t=s.documentos.map(i=>({...i,archivos:i.archivos||[]}));O(t),C(t[0]||null),te({}),We("legales"),await He(a),N(!0),v(!1)}else v(!1),N(!0)}catch{v(!1),N(!0)}},He=async a=>{if(a){Je(!0);try{const r=await Ee(`/documentos/campus/${a}/medico`);if(r.ok){const s=await r.json();Se(s.tiene_carreras_medicas),ue(s.carreras_medicas||[]),(s.carreras_medicas||[]).forEach(t=>{})}else Se(!1),ue([])}catch{Se(!1),ue([])}finally{Je(!1)}}},wa=(a,r)=>{a.preventDefault(),ye(r)},Ca=a=>{a.preventDefault(),ye(null)},Da=(a,r)=>{a.preventDefault(),ye(null);const s=Array.from(a.dataTransfer.files);Xe(s,r)},Xe=(a,r)=>{const s=a.filter(t=>{const i=t.type==="application/pdf"||t.name.toLowerCase().endsWith(".pdf");return i||alert(`El archivo "${t.name}" no es un PDF válido. Solo se permiten archivos PDF.`),i});s.length!==0&&te(t=>({...t,[r]:[...t[r]||[],...s]}))},za=(a,r)=>{if(a.target.files){const s=Array.from(a.target.files);Xe(s,r)}},_a=(a,r)=>{te(s=>({...s,[a]:s[a]?.filter((t,i)=>i!==r)||[]}))},Sa=async a=>{G.forEach((t,i)=>{console.log(`  Doc ${i}: key="${p(t)}", uniqueKey="${t.uniqueKey}", id="${t.id}"`)});const r=se[a],s=G.find(t=>p(t)===a);if(!s){alert("Error: Documento no encontrado");return}if(!r||r.length===0){console.log("No hay archivos para subir"),alert("No hay archivos seleccionados. Por favor selecciona un archivo primero.");return}if(!j?.ID_Campus){console.error("No hay campus seleccionado"),alert("No hay campus seleccionado");return}ne(!0),F(0),T("Preparando archivos..."),le(!1),me(0),Ce(r.length),te(t=>({...t,[a]:[]}));for(let t=0;t<r.length;t++){const i=r[t];de(i.name),T(`Subiendo ${i.name}...`),F(10);try{const d=new FormData;d.append("archivo",i);const n=s.documentoOriginalId||s.id;if(d.append("documento_id",n.toString()),d.append("campus_id",j.ID_Campus),s.carreraId){const c=String(s.carreraId);d.append("carrera_id",c)}for(let c of d.entries());await new Promise(c=>setTimeout(c,500)),F(25),T(`Validando ${i.name}...`),await new Promise(c=>setTimeout(c,500)),F(50),T(`Guardando ${i.name} en servidor...`),await new Promise(c=>setTimeout(c,500)),F(75),T(`Finalizando subida de ${i.name}...`);const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),h=new FormData;h.append("archivo",i),h.append("documento_id",n.toString()),h.append("campus_id",j.ID_Campus),s.carreraId&&h.append("carrera_id",s.carreraId);for(let c of h.entries())c[1]instanceof File;const g=await fetch("/documentos/subir-archivo",{method:"POST",headers:{"X-CSRF-TOKEN":b||""},body:h}),f=await g.text();if(g.ok)try{const c=JSON.parse(f);if(!c.archivo||!c.archivo.estado){T("Error: El archivo no se procesó correctamente en el servidor"),ne(!1);return}F(100),T(`${i.name} subido exitosamente`),me(u=>u+1),c.archivo.estado==="analizando"&&(T(`Analizando ${i.name} con IA...`),F(100),await new Promise(u=>setTimeout(u,2e3)));const D={id:c.archivo.id,nombre:i.name,tamaño:c.archivo.tamaño||i.size||0,fechaSubida:new Date().toISOString().split("T")[0],estado:c.archivo.estado==="analizando"?"analizando":"completado",progreso:100,mensaje:c.archivo.estado==="analizando"?"Analizando con IA...":"Completado"};O(u=>u.map(w=>p(w)===a?{...w,estado:"subido",archivos:[...q(w),D]}:w)),o&&p(o)===a&&C(u=>u&&{...u,estado:"subido",archivos:[...q(u),D]}),Be(u=>new Set(u).add(c.archivo.id)),setTimeout(()=>{Be(u=>{const w=new Set(u);return w.delete(c.archivo.id),w})},5e3),c.archivo.estado==="analizando"&&Ta(c.archivo.id,a,1),Ke()}catch{T("Error: El servidor devolvió una respuesta inválida"),ne(!1);return}else{try{const c=JSON.parse(f);c.validation_errors&&Object.keys(c.validation_errors).forEach(D=>{}),c.debug_info,T(`Error al subir ${i.name}: ${c.error||"Error desconocido"}`)}catch{T(`Error al subir ${i.name}: Error del servidor (${g.status})`)}F(0),await new Promise(c=>setTimeout(c,2e3))}}catch{T(`Error de conexión con ${i.name}`),F(0),v(!1),N(!0),xe(!1),await new Promise(n=>setTimeout(n,2e3))}}le(!0),F(100),T(`Todos los archivos procesados exitosamente (${we+1}/${r.length})`),de(""),await new Promise(t=>setTimeout(t,3e3)),ne(!1),le(!1),F(0),T(""),de(""),me(0),Ce(0)},[_e,Q]=m.useState(new Set),[Aa,Se]=m.useState(!1),[Ea,Je]=m.useState(!1),[Qe,ue]=m.useState([]),[H,W]=m.useState([]),[Ka,xe]=m.useState(!1),[V,We]=m.useState("legales");m.useEffect(()=>()=>{Q(new Set)},[]),m.useEffect(()=>{j?.ID_Campus&&He(j.ID_Campus)},[j]),m.useEffect(()=>{if(j)if(V!=="medicos"&&(v(!0),N(!1)),W([]),V==="medicos")setTimeout(()=>{ze()},50),N(!0),v(!1);else{const a=_.filter(r=>!r.concepto.toLowerCase().includes("cartas de intención de campo clínico"));a.length>0&&C(a[0]),N(!0),v(!1)}},[V,j]),m.useEffect(()=>{if(V==="medicos"&&H.length>0)if(!o||!o.uniqueKey)C(H[0]);else{const a=H.find(r=>r.uniqueKey===o.uniqueKey);a&&a!==o&&C(a)}},[H,V]);const Ta=async(a,r,s=2)=>{if(_e.has(a))return;Q(d=>new Set(d).add(a));let t=0;const i=async()=>{t++;try{const d=await Ee(`/documentos/analisis/estado?archivo_id=${a}`,{method:"GET"});if(d.ok){const n=await d.json();if(O(b=>b.map(h=>{if(p(h)===r){const g=q(h).map(u=>{if(u.id===a){const w=n.tiene_analisis;let he=w?"completado":"analizando",Y="";if(n.estado==="rechazado"||w&&n.analisis&&n.analisis.validacion&&!n.analisis.validacion.coincide){he="rechazado";let $="";n.analisis&&n.analisis.validacion?$=n.analisis.validacion.razon:n.analisis&&n.analisis.documento?$=n.analisis.documento.observaciones:$="Documento no cumple con los requisitos",Y=`Documento rechazado: ${$}`;const ge=_.find(A=>p(A)===r);Ue({fileName:u.nombre,documentType:ge?.concepto||"Documento",reason:$,percentage:0,expectedType:n.analisis?.validacion?.documento_esperado||ge?.concepto||"Tipo de documento requerido",detectedType:n.analisis?.validacion?.documento_detectado||n.analisis?.documento?.nombre_detectado||n.documento?.tipo_detectado||"Tipo no identificado",cityValidation:n.analisis?.validacion?.ciudad_campus?{campusCity:n.analisis.validacion.ciudad_campus,documentCities:n.analisis.validacion.ciudades_documento||[],isValid:n.analisis.validacion.coincide||!1,details:n.analisis.validacion.evaluacion_gpt==="ciudad_incorrecta"?"El documento pertenece a una ciudad diferente a la del campus seleccionado":void 0}:void 0}),oe(!0)}else if(w&&n.analisis&&n.analisis.validacion){let $=`Documento validado correctamente (${n.analisis.validacion.porcentaje_coincidencia}% coincidencia)`;n.analisis.validacion.ciudad_campus&&n.analisis.validacion.ciudades_documento&&($+=` • Ubicación: ${n.analisis.validacion.ciudad_campus} ✓`),Y=$}else w?Y="Análisis IA completado":Y=`Analizando documento... (${t}/${s})`;return{...u,estado:he,mensaje:Y,validacionIA:n.analisis?.validacion?{coincide:n.analisis.validacion.coincide,porcentaje:n.analisis.validacion.porcentaje_coincidencia,razon:n.analisis.validacion.razon,accion:n.analisis.validacion.accion}:void 0,fechaExpedicion:n.analisis?.documento?.fecha_expedicion,vigenciaDocumento:n.analisis?.documento?.vigencia_documento,diasRestantesVigencia:n.analisis?.documento?.dias_restantes_vigencia,metadata:n.metadata?{folio_documento:n.metadata.folio_documento,fecha_expedicion:n.metadata.fecha_expedicion,vigencia_documento:n.metadata.vigencia_documento,lugar_expedicion:n.metadata.lugar_expedicion,estado_bd:n.metadata.estado_bd||n.estado_bd}:void 0}}return u});let f=h.estado;const c=g.find(u=>u.estado==="completado"&&(!u.validacionIA||u.validacionIA.coincide));return g.find(u=>u.estado==="rechazado"||u.estado==="completado"&&u.validacionIA&&!u.validacionIA.coincide)?f="rechazado":c?f="vigente":g.some(u=>u.estado==="completado")&&(f="subido"),{...h,estado:f,archivos:g}}return h})),o&&p(o)===r&&C(b=>{if(b&&_.find(g=>p(g)===r)){const g=n.estado==="rechazado"||n.analisis?.validacion&&!n.analisis.validacion.coincide;return{...b,estado:g?"rechazado":n.analisis?.validacion?.coincide?"vigente":b.estado,archivos:b.archivos?.map(c=>{if(c.id===a){const D=g?"rechazado":n.tiene_analisis?"completado":"analizando";return{...c,estado:D,validacionIA:n.analisis?.validacion?{coincide:n.analisis.validacion.coincide,porcentaje:n.analisis.validacion.porcentaje_coincidencia,razon:n.analisis.validacion.razon,accion:n.analisis.validacion.accion}:void 0,fechaExpedicion:n.analisis?.documento?.fecha_expedicion,vigenciaDocumento:n.analisis?.documento?.vigencia_documento,diasRestantesVigencia:n.analisis?.documento?.dias_restantes_vigencia}}return c})||[]}}return b}),n.tiene_analisis||t>=s){if(Q(b=>{const h=new Set(b);return h.delete(a),h}),n.tiene_analisis){const b=_.find(f=>p(f)===r),h=b?.archivos?.find(f=>f.id===a);if(n.estado==="rechazado"||n.analisis&&n.analisis.validacion&&!n.analisis.validacion.coincide)setTimeout(()=>{O(f=>[...f])},100);else if(n.analisis?.validacion?.coincide){const f=b?.archivos?.find(c=>c.id===a);fa(`${f?.nombre||"Documento"} validado exitosamente`),De(!0),setTimeout(()=>De(!1),4e3),setTimeout(()=>{C(c=>c&&{...c})},500)}Ke()}!n.tiene_analisis&&t>=s&&O(b=>b.map(h=>{if(p(h)===r){const g=q(h).map(f=>f.id===a?{...f,estado:"error"}:f);return{...h,archivos:g}}return h}));return}setTimeout(i,2e3)}else t<s?setTimeout(i,2e3):Q(n=>{const b=new Set(n);return b.delete(a),b})}catch{t<s?setTimeout(i,3e3):Q(n=>{const b=new Set(n);return b.delete(a),b})}};i()},$a=()=>{Q(new Set),O(a=>a.map(r=>({...r,archivos:q(r).map(s=>s.estado==="analizando"?{...s,estado:"error"}:s)})))},Ye=a=>{const r=new Date,t=new Date(a).getTime()-r.getTime();return Math.ceil(t/(1e3*60*60*24))},Ia=a=>a<0?"text-red-600":a<=7?"text-orange-600":a<=30?"text-yellow-600":"text-green-600",k=a=>a.toLowerCase(),y=a=>{const r=S(a),s=k(r);if(s==="caducado")return!0;const t=Pe(a),i=t.diasRestantes!==null?t.diasRestantes:Ye(a.fechaLimite),d=s==="vigente"&&i<0;return d&&console.log("⏰ Documento caducado dinámicamente:",a.concepto,"Días restantes:",i),d},Ze=a=>{const r=S(a);if(y(a))return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-300 dark:border-orange-800";const s=k(r);return Oa(s)},ea=a=>{if(y(a))return e.jsx(J,{className:"w-3 h-3"});const r=S(a),s=k(r);return Ua(s)},aa=a=>{if(y(a))return"caducado";const r=S(a);return k(r)},S=a=>{const s=q(a).filter(t=>t.metadata?.estado_bd);return s.length>0&&s.sort((i,d)=>new Date(d.fechaSubida).getTime()-new Date(i.fechaSubida).getTime())[0].metadata?.estado_bd||a.estado},sa=_.filter(a=>{const r=a.concepto.toLowerCase().includes(re.toLowerCase())||a.descripcion.toLowerCase().includes(re.toLowerCase());let s=!1;const t=k(a.estado);return M==="todos"?s=!0:M==="subido"?s=t==="subido"||t==="vigente"||t==="caducado"||y(a):s=t===M||M==="caducado"&&y(a),r&&s}),G=(()=>{if(V==="legales")return sa.filter(a=>!a.concepto.toLowerCase().includes("cartas de intención de campo clínico"));{if(H.length>0)return console.log("🔄 Usando documentos médicos con estado actualizado:",H.length),H.filter(s=>{const t=s.concepto.toLowerCase().includes(re.toLowerCase())||s.descripcion.toLowerCase().includes(re.toLowerCase());let i=!1;const d=k(s.estado);return M==="todos"?i=!0:M==="subido"?i=d==="subido"||d==="vigente"||d==="caducado"||y(s):i=d===M||M==="caducado"&&y(s),t&&i});const a=sa.filter(s=>s.concepto.toLowerCase().includes("cartas de intención de campo clínico"));if(a.length===0||Qe.length===0)return[];const r=[];return Qe.forEach(s=>{a.forEach(t=>{const i=`${t.id}_carrera_${s.ID_Especialidad}`,d={id:t.id,concepto:`${t.concepto} - ${s.Descripcion}`,descripcion:`${t.descripcion} para la carrera de ${s.Descripcion}`,fechaLimite:t.fechaLimite,estado:"pendiente",archivos:[],obligatorio:t.obligatorio,categoria:t.categoria,documentoOriginalId:t.id,uniqueKey:i,carreraId:String(s.ID_Especialidad),carreraNombre:s.Descripcion};r.push(d)})}),r}})();return e.jsxs(Pa,{breadcrumbs:[{title:"Dashboard",href:"/dashboard"},{title:"Documentos",href:"/documentos"},{title:"Subir Documentos",href:"/documentos/upload"}],children:[e.jsx(Fa,{title:"Subida de Documentos",children:e.jsx("meta",{name:"csrf-token",content:document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""})}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[ha&&e.jsx("div",{className:"fixed top-4 right-4 z-40 animate-in slide-in-from-right-full duration-500",children:e.jsx(I,{className:"bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800 shadow-lg",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Archivo subido exitosamente"}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:ga})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>De(!1),className:"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200 hover:bg-green-100 dark:hover:bg-green-900/50 h-6 w-6 p-0",children:e.jsx(fe,{className:"w-3 h-3"})})]})})})}),la&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50",onClick:a=>a.preventDefault(),children:e.jsx(I,{className:"w-96 mx-4 dark:bg-gray-800 dark:border-gray-700",onClick:a=>a.stopPropagation(),children:e.jsx(R,{className:"p-8",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"relative",children:K?e.jsxs("div",{className:"w-16 h-16 mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-12 h-12 text-green-600 animate-pulse"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-green-600 rounded-full opacity-20 animate-ping"})})]}):e.jsxs("div",{className:"w-16 h-16 mx-auto",children:[e.jsx(ee,{className:"w-16 h-16 text-blue-600 animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full opacity-20 animate-ping"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:`text-lg font-semibold ${K?"text-green-900 dark:text-green-100":"text-gray-900 dark:text-gray-100"}`,children:K?"Documentos Subidos Exitosamente":"Procesando Documentos"}),Le&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Le}),e.jsx("p",{className:`text-sm font-medium ${K?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:ma}),K&&we>0&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[e.jsx(U,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:[we," de ",ua," archivo(s) procesado(s) exitosamente"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:"Progreso"}),e.jsxs("span",{children:[Ve,"%"]})]}),e.jsx(ta,{value:Ve,className:`h-3 ${K?"bg-green-100 dark:bg-green-900/30":"dark:bg-gray-700"}`})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:K?"Los documentos se están procesando en segundo plano...":"Por favor espera mientras procesamos tus documentos..."}),K&&e.jsxs(E,{onClick:()=>{ne(!1),le(!1),F(0),T(""),de(""),me(0),Ce(0)},className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Continuar"]})]})})})}),ba&&B&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",onClick:a=>a.preventDefault(),children:e.jsxs(I,{className:"w-full max-w-2xl bg-white dark:bg-gray-800 shadow-xl dark:border-gray-700",onClick:a=>a.stopPropagation(),children:[e.jsx(pe,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx(be,{className:"text-lg text-gray-900 dark:text-gray-100",children:"Documento Rechazado"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Validación automática"})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>oe(!1),className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 h-8 w-8 p-0",children:e.jsx(fe,{className:"w-4 h-4"})})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Archivo:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg",children:B.fileName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Motivo:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border-l-4 border-red-400 dark:border-red-600",children:B.reason})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Esperado:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900/20 p-2 rounded text-center",children:B.expectedType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Detectado:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 bg-orange-50 dark:bg-orange-900/20 p-2 rounded text-center",children:B.detectedType})]})]}),B.cityValidation&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Validación de Ubicación:"}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Campus:"}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white p-2 rounded border",children:["📍 ",B.cityValidation.campusCity]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Documento de:"}),e.jsxs("p",{className:"text-sm text-gray-700 bg-white p-2 rounded border",children:["🏙️ ",B.cityValidation.documentCities.join(", ")||"No detectado"]})]})]}),B.cityValidation.details&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-yellow-800",children:[e.jsx(L,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:B.cityValidation.details})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"¿Qué hacer?"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Suba el documento correcto o contacte al administrador si considera que es un error."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(E,{variant:"outline",onClick:()=>oe(!1),className:"flex-1",children:"Cerrar"}),e.jsxs(E,{onClick:()=>{oe(!1),(o?document.getElementById(`file-input-${p(o)}`):null)?.scrollIntoView({behavior:"smooth"})},className:"flex-1",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Subir Documento Correcto"]})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2 dark:text-gray-100",children:"Subir Documentos"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400",children:"Selecciona un campus y un documento de la lista para subir los archivos requeridos"})]}),_e.size>0&&e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin"}),e.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:[_e.size," análisis en curso"]})]}),e.jsxs(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-blue-700 dark:text-blue-300 hover:text-blue-900 dark:hover:text-blue-100 hover:bg-blue-100 dark:hover:bg-blue-900/50",onClick:$a,children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Detener"]})]})]})}),(!l||!Array.isArray(l)||l.length===0)&&e.jsx(I,{className:"mb-6 border-destructive",children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("p",{className:"font-medium",children:P||"No tienes campus asignados para subir documentos"})]})})}),j&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 mb-6",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Total ",V==="medicos"?"Médicos":"Legales"]}),e.jsx("p",{className:"text-2xl font-bold",children:G.length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oa,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>k(a.estado)==="pendiente").length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Completados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>k(a.estado)==="vigente"&&!y(a)).length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Caducados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>k(a.estado)==="caducado"||y(a)).length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Rechazados"}),e.jsx("p",{className:"text-2xl font-bold",children:G.filter(a=>k(a.estado)==="rechazado").length})]})]})})})]}),j&&e.jsxs(e.Fragment,{children:[Oe&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(I,{className:"h-fit",children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(be,{className:"text-lg",children:"Documentos Requeridos"}),l&&Array.isArray(l)&&l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{htmlFor:"campus-select",className:"text-sm font-medium text-muted-foreground",children:"Campus:"}),e.jsxs($e,{value:j?.ID_Campus||"",onValueChange:Ge,children:[e.jsx(Ie,{className:"w-52",children:e.jsx(Re,{placeholder:"Selecciona campus"})}),e.jsx(Fe,{children:[...l].sort((a,r)=>a.Campus.localeCompare(r.Campus,"es",{sensitivity:"base"})).map(a=>e.jsx(je,{value:a.ID_Campus,children:a.Campus},a.ID_Campus))})]})]})]})}),e.jsx(R,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ee,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Cargando Documentos"}),e.jsx("p",{className:"text-sm text-gray-500",children:V==="medicos"?"Obteniendo estados de documentos médicos...":"Obteniendo documentos legales..."})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(I,{className:"h-fit",children:e.jsx(R,{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto",children:e.jsx(X,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-300",children:"Preparando Información"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Por favor espera mientras cargamos la información completa..."})]})]})})})})]}),!Oe&&pa&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(I,{className:"h-fit",children:[e.jsxs(pe,{className:"pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(be,{className:"text-lg",children:"Documentos Requeridos"}),l&&Array.isArray(l)&&l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{htmlFor:"campus-select",className:"text-sm font-medium text-muted-foreground",children:"Campus:"}),e.jsxs($e,{value:j?.ID_Campus||"",onValueChange:Ge,children:[e.jsx(Ie,{className:"w-52",children:e.jsx(Re,{placeholder:"Selecciona campus"})}),e.jsx(Fe,{children:[...l].sort((a,r)=>a.Campus.localeCompare(r.Campus,"es",{sensitivity:"base"})).map(a=>e.jsx(je,{value:a.ID_Campus,children:a.Campus},a.ID_Campus))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"text-sm font-medium text-muted-foreground",children:"Tipo:"}),e.jsxs($e,{value:V,onValueChange:a=>{We(a)},children:[e.jsx(Ie,{className:"w-40",children:e.jsx(Re,{})}),e.jsxs(Fe,{children:[e.jsx(je,{value:"legales",children:"Legales"}),Aa&&e.jsx(je,{value:"medicos",children:"Médicos"})]})]}),Ea&&e.jsx(ee,{className:"w-4 h-4 animate-spin text-blue-500"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ba,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ma,{placeholder:"Buscar documento...",value:re,onChange:a=>da(a.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:M==="todos"?"default":"outline",size:"sm",onClick:()=>ke("todos"),children:"Todos"}),e.jsx(E,{variant:M==="pendiente"?"default":"outline",size:"sm",onClick:()=>ke("pendiente"),children:"Pendientes"}),e.jsx(E,{variant:M==="subido"?"default":"outline",size:"sm",onClick:()=>ke("subido"),children:"Subidos"})]})]})]})]}),e.jsx(R,{className:"p-0",children:e.jsx("div",{ref:ce,className:"max-h-[600px] overflow-y-auto",children:G.map(a=>{const r=a.uniqueKey||a.id,s=o?.uniqueKey===r||o?.id===a.id&&!a.uniqueKey;return e.jsxs("div",{className:`p-4 border-b cursor-pointer transition-colors hover:bg-muted/50 ${s?"bg-primary/10 border-l-4 border-l-primary":""}`,onClick:t=>{t.preventDefault();const i=ce.current?.scrollTop||0;C(a),requestAnimationFrame(()=>{ce.current&&(ce.current.scrollTop=i)})},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-2",children:a.concepto}),a.obligatorio&&e.jsx(Z,{variant:"destructive",className:"text-xs ml-2",children:"Req."})]}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(Z,{className:Ze(a),variant:"outline",children:[ea(a),e.jsx("span",{className:"ml-1 capitalize text-xs",children:aa(a)})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(J,{className:"w-3 h-3"}),(()=>{const t=Pe(a),d=(t.diasRestantes!==null?t.diasRestantes:Ye(a.fechaLimite))??0;return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:ve(t.fecha)}),e.jsxs("span",{className:`font-medium ${Ia(d)}`,children:["(",d>=0?`${d}d`:`${Math.abs(d)}d vencido`,")"]})]})})()]})]},r)})})})]})}),e.jsx("div",{className:"lg:col-span-2",children:o?e.jsxs(I,{className:"h-fit dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs(pe,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(be,{className:"text-xl dark:text-gray-100",children:o.concepto}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 mt-1",children:o.descripcion})]}),e.jsx(Z,{className:Ze(o),children:e.jsxs("div",{className:"flex items-center gap-1",children:[ea(o),e.jsx("span",{className:"capitalize",children:aa(o)})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm pt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground dark:text-gray-400",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsxs("span",{children:["Vence: ",ve(Pe(o).fecha)]})]}),o.obligatorio&&e.jsx(Z,{variant:"destructive",className:"text-xs",children:"Documento Obligatorio"}),y(o)&&e.jsx(Z,{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 border-orange-300 dark:border-orange-800",children:"CADUCADO"}),o?.carreraNombre&&e.jsx(Z,{variant:"secondary",className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-400",children:o.carreraNombre})]})]}),e.jsxs(R,{className:"space-y-6",children:[q(o).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 dark:text-gray-200",children:["Archivos subidos (",q(o).length,")"]}),e.jsx("div",{className:"space-y-2",children:q(o).map(a=>{const r=o?.estado==="rechazado"||a.validacionIA&&!a.validacionIA.coincide,s=y(o);let t="";return xa.has(a.id)?t="border-green-400 dark:border-green-600 bg-green-50 dark:bg-green-900/20 shadow-lg ring-2 ring-green-200 dark:ring-green-800 ring-opacity-50 animate-pulse":a.estado==="subiendo"||a.estado==="procesando"||a.estado==="analizando"?t="border-blue-300 dark:border-blue-700 bg-blue-50 dark:bg-blue-900/20 shadow-lg":a.estado==="completado"?r?t="border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":s?t="border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20":t="border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":a.estado==="rechazado"?t="border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/20 shadow-lg":a.estado==="error"?t="border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20":t="border-gray-200 dark:border-gray-700 dark:bg-gray-800/50",e.jsx("div",{className:`p-3 border rounded-lg transition-all duration-300 ${t}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-3 flex-1",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium dark:text-gray-200",children:a.nombre}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:na(a)}),"                                                                    ",a.estado==="subiendo"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-bounce"}),e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:a.mensaje||"Subiendo archivo..."}),e.jsxs("span",{className:"text-xs text-blue-500 dark:text-blue-400 font-bold",children:[a.progreso,"%"]})]}),e.jsx(ta,{value:a.progreso,className:"h-3 bg-blue-100 dark:bg-blue-900/30"})]}),a.estado==="procesando"&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 animate-spin"}),e.jsx("span",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-300",children:a.mensaje||"Procesando documento..."})]})}),a.estado==="analizando"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ca,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:a.mensaje||"Analizando con IA..."})]}),e.jsx("div",{className:"mt-1 text-xs text-purple-600 dark:text-purple-400",children:e.jsx("div",{className:"mt-1 text-xs text-purple-600 dark:text-purple-400",children:"procesando el documento..."})})]}),a.estado==="completado"&&e.jsxs(e.Fragment,{children:[(()=>{const i=o?.estado==="rechazado"||a.validacionIA&&!a.validacionIA.coincide,d=y(o);return i?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(L,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:"Documento Rechazado"}),a.validacionIA&&e.jsxs("span",{className:"text-xs bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400 px-2 py-1 rounded",children:["No aprobado (",a.validacionIA.porcentaje,"%)"]})]}):d?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(J,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsx("span",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"Documento Caducado"}),e.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-400 px-2 py-1 rounded",children:"Vencido - Requiere Renovación"})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(U,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Documento Vigente"}),a.validacionIA&&e.jsxs("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400 px-2 py-1 rounded",children:["Aprobado (",a.validacionIA.porcentaje,"%)"]})]})})(),e.jsxs("div",{className:"mt-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Vista Previa del Documento"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.nombre})]})]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>window.open(`/documentos/file/${a.file_hash_sha256}`,"_blank"),className:"gap-2 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm",children:[e.jsx(ra,{className:"w-4 h-4"}),"Abrir Completo"]})]})}),e.jsxs("div",{className:"relative bg-gray-50 dark:bg-gray-900",children:[e.jsx("iframe",{src:`/documentos/archivo/${a.id}#toolbar=1&navpanes=0&scrollbar=1&view=FitH&zoom=125`,className:"w-full h-[700px] bg-white dark:bg-gray-900",title:`Preview de ${a.nombre}`,style:{backgroundColor:"#ffffff",border:"none",borderRadius:"0"},onError:()=>{console.log("Error cargando preview del PDF")},loading:"lazy",allowFullScreen:!0}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-all duration-300 pointer-events-none",children:e.jsxs("div",{className:"text-center text-white bg-gray-900 dark:bg-gray-800 bg-opacity-80 p-6 rounded-lg backdrop-blur-sm",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Documento PDF Validado"}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Haz clic para abrir en una nueva ventana"}),e.jsxs(E,{variant:"secondary",onClick:()=>window.open(`/documentos/file/${a.file_hash_sha256}`,"_blank"),className:"gap-2 pointer-events-auto bg-white text-gray-900 hover:bg-gray-100",children:[e.jsx(ra,{className:"w-4 h-4"}),"Ver en Nueva Ventana"]})]})})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:e.jsx("div",{className:"flex items-center gap-4 text-xs",children:e.jsx("span",{children:na(a)})})})})]})]}),a.estado==="rechazado"&&e.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-700",children:"Documento Rechazado"})]}),a.validacionIA&&e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>ya(a,o.concepto),className:"text-red-600 hover:text-red-800 hover:bg-red-100 h-6 px-2",children:e.jsx("span",{className:"text-xs",children:"Ver detalles"})})]}),a.validacionIA&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium mb-1",children:"Motivo del rechazo:"}),e.jsx("p",{className:"text-xs text-red-700",children:a.validacionIA.razon}),a.validacionIA.porcentaje!==void 0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Coincidencia: ",a.validacionIA.porcentaje,"%"]})]})]}),a.estado==="error"&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(L,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-700",children:a.mensaje||"Error en proceso"})]})]})})})},a.id)})})]}),(se[p(o)]||[]).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 dark:text-gray-200",children:["Archivos seleccionados (",(se[p(o)]||[]).length,")"]}),e.jsx("div",{className:"space-y-2",children:(se[p(o)]||[]).map((a,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary/5 dark:bg-primary/10 rounded-lg border border-primary/20 dark:border-primary/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium dark:text-gray-200",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:Me(a.size)})]})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>_a(p(o),r),className:"text-destructive hover:text-destructive dark:text-red-400 dark:hover:text-red-300",children:e.jsx(fe,{className:"w-4 h-4"})})]},r))}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(E,{onClick:()=>Sa(p(o)),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Subir Archivos (",(se[p(o)]||[]).length,")"]}),e.jsx(E,{variant:"outline",onClick:()=>te(a=>({...a,[p(o)]:[]})),children:"Cancelar"})]})]}),(k(S(o))!=="vigente"||y(o))&&ja(o)?e.jsxs("div",{className:`
                                                border-2 border-dashed rounded-lg p-8 text-center transition-colors
                                                ${qe===p(o)?"border-primary bg-primary/5 dark:bg-primary/10":"border-muted-foreground/25 hover:border-muted-foreground/50 dark:border-gray-700 dark:hover:border-gray-600"}
                                            `,onDragOver:a=>wa(a,p(o)),onDragLeave:Ca,onDrop:a=>Da(a,p(o)),children:[e.jsx(ae,{className:`
                                                w-12 h-12 mx-auto mb-4
                                                ${qe===p(o)?"text-primary":"text-muted-foreground dark:text-gray-400"}
                                            `}),e.jsx("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Arrastra archivos aquí"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 mb-4 text-sm",children:"o haz clic para seleccionar archivos"}),e.jsx("input",{type:"file",id:`file-input-${p(o)}`,className:"hidden",multiple:!0,accept:".pdf",onChange:a=>za(a,p(o))}),e.jsxs(E,{variant:"outline",onClick:()=>{document.getElementById(`file-input-${p(o)}`)?.click()},children:[e.jsx(Va,{className:"w-4 h-4 mr-2"}),"Seleccionar Archivos"]}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-gray-400 mt-3",children:"Formatos: PDF"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-8 text-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:k(S(o))==="vigente"&&!y(o)?e.jsx(U,{className:"w-12 h-12 text-green-600 dark:text-green-400"}):k(S(o))==="rechazado"?e.jsx(L,{className:"w-12 h-12 text-red-600 dark:text-red-400"}):k(S(o))==="caducado"||y(o)?e.jsx(J,{className:"w-12 h-12 text-orange-600 dark:text-orange-400"}):e.jsx(L,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"font-semibold mb-2 text-gray-700 dark:text-gray-200",children:k(S(o))==="vigente"&&!y(o)?"Documento Aprobado":k(S(o))==="rechazado"?"Documento Rechazado - Puede Subir Nuevo":k(S(o))==="caducado"||y(o)?"Documento Caducado - Puede Subir Nuevo":"Subida Bloqueada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:ka(o)}),k(S(o))==="vigente"&&!y(o)&&e.jsxs("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg p-3 text-green-800 dark:text-green-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento ha sido validado y aprobado."}),e.jsx("p",{className:"text-xs mt-1 text-green-700 dark:text-green-400",children:"No se pueden realizar más cambios a menos que sea rechazado por un administrador."})]}),k(S(o))==="rechazado"&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-3 text-red-800 dark:text-red-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento fue rechazado por un administrador."}),e.jsx("p",{className:"text-xs mt-1 text-red-700 dark:text-red-400",children:"Por favor, revise los comentarios y suba una nueva versión."})]}),(k(S(o))==="caducado"||y(o))&&e.jsxs("div",{className:"bg-orange-100 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-3 text-orange-800 dark:text-orange-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Este documento ha caducado por vencimiento de fecha."}),e.jsx("p",{className:"text-xs mt-1 text-orange-700 dark:text-orange-400",children:"Puede subir una nueva versión actualizada del documento."})]})]})]})]}):e.jsx(I,{className:"h-full dark:bg-gray-800 dark:border-gray-700",children:e.jsx(R,{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-12 h-12 text-muted-foreground dark:text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Selecciona un documento"}),e.jsx("p",{className:"text-muted-foreground dark:text-gray-400 text-sm",children:"Elige un documento de la lista para comenzar a subir archivos"})]})})})})]})]})]})]})};export{gs as default};
